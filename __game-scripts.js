pc.DEFAULT_HUMAN_HEIGHT=1.67,function(){pc.util={},pc.util.DEBUG=!1,pc.util.DEFAULT_VEC3_0=new pc.Vec3(0,0,0),pc.util.DEFAULT_VEC3_1=new pc.Vec3(1,1,1),pc.util.DEFAULT_QUAT=new pc.Quat(0,0,0,1),pc.util.HIGHLIGHT_ENTITY_GREEN=new pc.Color(.25,.5,.25),pc.util.HIGHLIGHT_ENTITY_RED=new pc.Color(.25,.125,.125),pc.util.HIGHLIGHT_ENTITY_DEFAULT=new pc.Color(0,0,0),pc.util.setEntityAlpha=function(t,n){for(var e=pc.math.clamp(n,0,1),r=pc.util.getMeshInstances(t),i=0;i<r.length;++i)r[i].setParameter("material_opacity",e)},pc.util.setEntityEmissive=function(t,n){for(var e=pc.util.getMeshInstances(t),r=0;r<e.length;++r)e[r].setParameter("material_emissive",n.data3)},pc.util.isMobile=function(){return/Android/i.test(navigator.userAgent)||/iPhone|iPad|iPod/i.test(navigator.userAgent)},pc.util.canPlayOgg=function(){var t=navigator.userAgent.toLowerCase();return!(t.search("safari")>=0&&t.search("chrome")<0)},pc.util.unitCurve=function(t,n){if(1==n)return t;var e=t,r=n-n*e+e;return 0!==r&&(e/=r),e},pc.util.sCurve=function(t){return t*t*(3-2*t)},pc.util.playSoundSlot=function(t,n,e){if(t.sound){var r=t.sound.slots[n];return r&&(e&&(r.volume=e),r.play()),r}return null},pc.util.stopSoundSlot=function(t,n){if(t.sound){var e=t.sound.slots[n];return e&&e.stop(),e}return null},pc.util.pauseSoundSlot=function(t,n){if(t.sound){var e=t.sound.slots[n];return e&&e.pause(),e}return null},pc.util.isPlayingSoundSlot=function(t,n){if(t.sound){var e=t.sound.slots[n];if(e)return e.isPlaying}return!1},pc.util.initSoundSlotAssets=function(t,n){var e=pc.util.canPlayOgg()?".ogg":".mp3",r=n.sound?n.sound.slots:null,i=0;if(r)for(var o in r)if(r.hasOwnProperty(o)){var s=t.assets.find(o+e,"audio");s&&(r[o].asset=s.id,i+=1)}return i};var t=new pc.Vec3;pc.util.getYaw=function(n){var e=t;return n.transformVector(pc.Vec3.FORWARD,e),Math.atan2(-e.x,-e.z)*pc.math.RAD_TO_DEG};var n=new pc.Quat,e=new pc.Quat;pc.util.angleBetweenQuats=function(t,r){var i=n.copy(t).invert(),o=e.mul2(r,i),s=2*Math.acos(pc.math.clamp(o.w,-1,1))*pc.math.RAD_TO_DEG;return s>180&&(s=360-s),s},pc.util.clampQuatToYAxis=function(t){t.x=0,t.z=0;var n=Math.sqrt(t.w*t.w+t.y*t.y);t.w/=n,t.y/=n},pc.util.getMeshInstances=function(t){if(t.model)return t.model.meshInstances;var n=[];if(t instanceof pc.Entity)for(var e=t.findComponents("render"),r=0;r<e.length;++r)for(var i=e[r].meshInstances,o=0;o<i.length;o++)n.push(i[o]);return n}}(),pc.extend(pc,function(){var t=function OrientatedBox(t,n){this.halfExtents=t||new pc.Vec3(.5,.5,.5),this._worldTransform=n||new pc.Mat4,this._modelTransform=this._worldTransform.clone().invert(),this._aabb=new pc.BoundingBox(new pc.Vec3,this.halfExtents)},n=new pc.Ray,e=new pc.Vec3,r=new pc.BoundingSphere;return t.prototype={intersectsRay:function(t,e){if(this._modelTransform.transformPoint(t.origin,n.origin),this._modelTransform.transformVector(t.direction,n.direction),e){var r=this._aabb._intersectsRay(n,e);return this._worldTransform.transformPoint(e,e),r}return modelBox._fastIntersectsRay(this._transformedRay)},containsPoint:function(t){return this._modelTransform.transformPoint(t,e),this._aabb.containsPoint(e)},intersectsBoundingSphere:function(t){return this._modelTransform.transformPoint(t.center,r.center),r.radius=t.radius,!!this._aabb.intersectsBoundingSphere(r)}},Object.defineProperty(t.prototype,"worldTransform",{get:function(){return this._worldTransform},set:function(t){this._worldTransform=t,this._modelTransform.copy(this._worldTransform).invert()}}),{OrientatedBox:t}}()),pc.BoundingSphere.diffBetweenPoints=new pc.Vec3,pc.BoundingSphere.prototype.intersectsBoundingSphere=function(t){var n=pc.BoundingSphere.diffBetweenPoints;n.sub2(t.center,this.center);var e=t.radius+this.radius;return n.lengthSq()<=e*e},pc.BoundingBox.prototype._distanceToBoundingSphereSq=function(t){for(var n=this.getMin(),e=this.getMax(),r=0,i=0;i<3;++i){var o=0,s=t.center.data[i],a=n.data[i],u=e.data[i],c=0;s<a&&(o+=(c=a-s)*c),s>u&&(o+=(c=s-u)*c),r+=o}return r},pc.BoundingBox.prototype.intersectsBoundingSphere=function(t){return this._distanceToBoundingSphereSq(t)<=t.radius*t.radius};var AudioAnalyser=pc.createScript("audioAnalyser");AudioAnalyser.attributes.add("fftsize",{type:"number"}),AudioAnalyser.prototype.assignSoundSlot=function(t){if(t){t.setExternalNodes(this.analyser);var e=this.analyser.minDecibels,s=this.analyser.maxDecibels;this.freqScale=1/(s-e),this.freqOffset=e,this.soundSlot=t}},AudioAnalyser.prototype.initialize=function(){var t=this.app.systems.sound.context;this.analyser=t.createAnalyser(),this.analyser.smoothingTimeConstant=.6,this.analyser.fftSize=this.fftsize,this.freqData=new Float32Array(this.fftsize/2),this.freqScale=0,this.freqOffset=0,this.soundSlot=null},AudioAnalyser.prototype.update=function(t){this.analyser.getFloatFrequencyData(this.freqData)};var RenderLayer=pc.createScript("renderLayer");RenderLayer.attributes.add("layer",{type:"number",default:14,title:"Layer",description:"Has to be between a value of 3 and 14. 3 being the highest priority"}),RenderLayer.prototype.initialize=function(){this.on("attr:layer",(function(e,t){this._setLayer(e)})),this._setLayer(this.layer)},RenderLayer.prototype._setLayer=function(e){e=pc.math.clamp(e,0,15);var t=0,a=pc.util.getMeshInstances(this.entity);if(a)for(t=0;t<a.length;++t)a[t].layer=e;var r=this.entity.particlesystem;r&&r.emitter.meshInstance&&(r.emitter.meshInstance.layer=e);var n=this.entity.element;if(n&&(n._text&&n._text._meshInstance&&(n._text._meshInstance.layer=e),n._image&&(a=n._image._model.meshInstances)))for(t=0;t<a.length;++t)a[t].layer=e};var ShapeWorld=pc.createScript("shapeWorld");ShapeWorld.prototype.initialize=function(){this._pickableEntities=[],this._pickableShapes=[],this.app.on("shapeworld:add",this.addItem,this),this.app.on("shapeworld:remove",this.removeItem,this),this.app.shapeWorld=this},ShapeWorld.hitPoint=new pc.Vec3,ShapeWorld.vecBetween=new pc.Vec3,ShapeWorld.prototype.raycast=function(e,t,i,p){for(var a=ShapeWorld.hitPoint,s=(ShapeWorld.vecBetween,p||1/0),h=null,n=0;n<this._pickableShapes.length;++n){var r=this._pickableShapes[n],o=this._pickableEntities[n];if((!t||t(o)&&o.enabled)&&r.intersectsRay(e,a)){var l=e.origin.distance(a);l<s&&(s=l,h=o,i&&i.copy(a))}}return h},ShapeWorld.prototype.containsPoint=function(e,t){for(var i=null,p=0;p<this._pickableShapes.length;++p){var a=this._pickableShapes[p],s=this._pickableEntities[p];if((!t||t(s)&&s.enabled)&&a.containsPoint(e)){i=s;break}}return i},ShapeWorld.prototype.intersectsSphere=function(e,t){for(var i=null,p=0;p<this._pickableShapes.length;++p){var a=this._pickableShapes[p],s=this._pickableEntities[p];if((!t||t(s)&&s.enabled)&&a.intersectsBoundingSphere(e)){i=s;break}}return i},ShapeWorld.prototype.addItem=function(e,t){e&&(this._pickableEntities.push(e),this._pickableShapes.push(t))},ShapeWorld.prototype.removeItem=function(e){var t=this._items.indexOf(e);t>=0&&(this._pickableEntities.splice(t,1),this._pickableShapes.splice(t,1))};var Shape=pc.createScript("shape");Shape.attributes.add("type",{type:"string",enum:[{Sphere:"sphere"},{AABB:"aabb"},{OBB:"obb"}],default:"sphere",title:"Type"}),Shape.attributes.add("childOfActualEntity",{type:"boolean",default:!1,title:"Child Of Actual Entity",description:"Tick if the shape is a child of the actual entity object"}),Shape.attributes.add("keepUpdating",{type:"boolean",default:!1,title:"Keep Updating",description:"Update the shape data every frame (only toggle if the entity moves as can be expensive)"}),Shape.attributes.add("addToObject",{type:"string",enum:[{Global:"app"},{"Actual Entity":"actualEntity"}],title:"Add to Object",default:"app"}),Shape.prototype.initialize=function(){switch(this._halfExtents=this.entity.getLocalScale().clone().scale(.5),this.type){case"sphere":this._shape=new pc.BoundingSphere(this.entity.getPosition().clone(),Math.max(this._halfExtents.x,Math.max(this._halfExtents.y,this._halfExtents.z)));break;case"aabb":this._shape=new pc.BoundingBox(this.entity.getPosition().clone(),this._halfExtents);break;case"obb":this._worldTransform=(new pc.Mat4).setTRS(this.entity.getPosition(),this.entity.getRotation(),pc.util.DEFAULT_VEC3_1),this._shape=new pc.OrientatedBox(this._halfExtents,this._worldTransform)}},Shape.prototype.postInitialize=function(){this._getAddToObject().fire("shapeworld:add",this._getActualEntity(),this._shape),this.on("state",this._onStateChanged,this)},Shape.prototype.update=function(t){if(this.keepUpdating)switch(this.type){case"sphere":case"aabb":this._shape.center.copy(this.entity.getPosition());break;case"obb":this._worldTransform.setTRS(this.entity.getPosition(),this.entity.getRotation(),pc.util.DEFAULT_VEC3_1),this._shape.worldTransform=this._worldTransform}},Shape.prototype._onStateChanged=function(t){var e=this._getAddToObject();t?e.fire("shapeworld:add",this._getActualEntity(),this._shape):e.fire("shapeworld:remove",this._getActualEntity(),this._shape)},Shape.prototype._getAddToObject=function(){switch(this.addToObject){case"app":return this.app;case"actualEntity":return this._getActualEntity();default:return null}},Shape.prototype._getActualEntity=function(){return this.childOfActualEntity?this.entity.parent:this.entity};var Button=pc.createScript("button");Button.attributes.add("coolDownTime",{type:"number",default:1,title:"Cool Down Time (secs)"}),Button.STATE_IDLE="IDLE",Button.STATE_ACTIVATED="ACTIVATED",Button.prototype.initialize=function(){this.entity.on("object:interact",this._onInteract,this),this.entity.on("object:onhover",this._onHover,this),this.entity.on("object:offhover",this._offHover,this),this._state=Button.STATE_IDLE,this._secsSinceActivation=0},Button.prototype.update=function(t){switch(this._state){case Button.STATE_IDLE:break;case Button.STATE_ACTIVATED:this._secsSinceActivation+=t,this._secsSinceActivation>=this.coolDownTime&&(this.entity.fire("button:reseted"),this._state=Button.STATE_IDLE)}},Button.controllerMovementDirection=new pc.Vec2,Button.DOT_THRESHOLD=-.3,Button.prototype._onInteract=function(t){if(this._isIdle()){var i=Button.controllerMovementDirection.copy(this.entity.up);i.scale(-1),t.getMovementDirection&&(i.copy(t.getMovementDirection()),loadScene("Main 2",{hierarchy:!0,settings:!0})),i.dot(this.entity.up)<=Button.DOT_THRESHOLD&&(this.entity.fire("button:activated"),this._secsSinceActivation=0,this._state=Button.STATE_ACTIVATED,this._removeHighlight(this.entity))}},Button.prototype._onHover=function(){this._isIdle()&&this._addHighlight(this.entity)},Button.prototype._offHover=function(){this._isIdle()&&this._removeHighlight(this.entity)},Button.prototype._isIdle=function(){return this._state==Button.STATE_IDLE},Button.prototype._addHighlight=function(t){pc.util.setEntityEmissive(t,pc.util.HIGHLIGHT_ENTITY_GREEN);for(var i=t.children,e=0;e<i.length;++e)this._addHighlight(i[e])},Button.prototype._removeHighlight=function(t){pc.util.setEntityEmissive(t,pc.util.HIGHLIGHT_ENTITY_DEFAULT);for(var i=t.children,e=0;e<i.length;++e)this._removeHighlight(i[e])};var ControllerTrigger=pc.createScript("controllerTrigger");ControllerTrigger.attributes.add("coolDownTime",{type:"number",default:1,title:"Cool Down Time (secs)"}),ControllerTrigger.STATE_IDLE="IDLE",ControllerTrigger.STATE_ACTIVATED="ACTIVATED",ControllerTrigger.prototype.initialize=function(){this.entity.on("object:interact",this._onInteract,this),this.entity.on("object:onhover",this._onHover,this),this.entity.on("object:offhover",this._offHover,this),this._state=ControllerTrigger.STATE_IDLE,this._secsSinceActivation=0},ControllerTrigger.prototype.update=function(t){switch(this._state){case ControllerTrigger.STATE_IDLE:break;case ControllerTrigger.STATE_ACTIVATED:this._secsSinceActivation+=t,this._secsSinceActivation>=this.coolDownTime&&(this.entity.fire("controllertrigger:reseted"),this._state=ControllerTrigger.STATE_IDLE)}},ControllerTrigger.controllerMovementDirection=new pc.Vec2,ControllerTrigger.DOT_THRESHOLD=-.3,ControllerTrigger.prototype._onInteract=function(t){this._isIdle()&&(this.entity.fire("controllertrigger:activated"),this._secsSinceActivation=0,this._state=ControllerTrigger.STATE_ACTIVATED,this._removeHighlight(this.entity))},ControllerTrigger.prototype._onHover=function(){this._isIdle()&&this._addHighlight(this.entity)},ControllerTrigger.prototype._offHover=function(){this._isIdle()&&this._removeHighlight(this.entity)},ControllerTrigger.prototype._isIdle=function(){return this._state==ControllerTrigger.STATE_IDLE},ControllerTrigger.prototype._addHighlight=function(t){pc.util.setEntityEmissive(t,pc.util.HIGHLIGHT_ENTITY_GREEN);for(var e=t.children,r=0;r<e.length;++r)this._addHighlight(e[r])},ControllerTrigger.prototype._removeHighlight=function(t){pc.util.setEntityEmissive(t,pc.util.HIGHLIGHT_ENTITY_DEFAULT);for(var e=t.children,r=0;r<e.length;++r)this._removeHighlight(e[r])};var DoorHandle=pc.createScript("doorHandle");DoorHandle.attributes.add("side",{type:"string",enum:[{left:"left"},{right:"right"}],default:"left",title:"Side"}),DoorHandle.attributes.add("numberShakes",{type:"number",default:1,title:"Number of Shakes"}),DoorHandle.attributes.add("animLength",{type:"number",default:1,title:"Animation Length (secs)"}),DoorHandle.attributes.add("rotateRange",{type:"number",default:0,title:"",description:"Rotate Range (degress)"}),DoorHandle.prototype.initialize=function(){pc.util.initSoundSlotAssets(this.app,this.entity),this.secsSinceActivation=0,this.entity.on("controllertrigger:activated",this._onActivated,this)},DoorHandle.SIN_SCALE=1.3,DoorHandle.prototype.update=function(t){var e=Math.min(this.secsSinceActivation/this.animLength,1),i=pc.math.clamp(Math.sin(e*(Math.PI*this.numberShakes))*DoorHandle.SIN_SCALE,-1,1)*this.rotateRange;"right"==this.side&&(i*=-1),this.entity.setLocalEulerAngles(0,0,i),this.secsSinceActivation+=t},DoorHandle.prototype._onActivated=function(){this.secsSinceActivation=0,pc.util.playSoundSlot(this.entity,"locked-room-doors")};var Grabbable=pc.createScript("grabbable");Grabbable.STATE_IDLE="IDLE",Grabbable.STATE_RESET_TELEPORT_OUT="RESET_TELEPORT_OUT",Grabbable.STATE_RESET_TELEPORT_IN="RESET_TELEPORT_IN",Grabbable.STATE_IN_USE_WITH="IN_USE_WITH",Grabbable.prototype.initialize=function(){this.entity.on("object:onhover",this._onHover,this),this.entity.on("object:offhover",this._offHover,this),this.entity.on("object:hold",this._onHold,this),this.entity.on("object:release",this._onRelease,this),this._controller=null,this._grabRotationOffset=new pc.Quat,this._wasGrabbed=!1,this._secsSinceReleased=0,this._yPositionWhenStopped=0,this._startLocalTransform=this.entity.getLocalTransform().clone(),this._state=Grabbable.STATE_IDLE,this._secsSinceStateChange=0,this._prevPosition=(new pc.Vec3).copy(this.entity.getPosition()),this._releasedVelocity=new pc.Vec3,this._positionWithoutBob=(new pc.Vec3).copy(this.entity.getPosition())},Grabbable.RESET_TIMEOUT=10,Grabbable.BOB_HEIGHT=.1,Grabbable.BOB_ANIM_LENGTH=4,Grabbable.prototype.postUpdate=function(t){switch(this._secsSinceStateChange+=t,this._state){case Grabbable.STATE_IDLE:this._updateStateIdle(t);break;case Grabbable.STATE_RESET_TELEPORT_OUT:this._updateStateResetTeleportOut(t);break;case Grabbable.STATE_RESET_TELEPORT_IN:this._updateStateResetTeleportIn(t)}},Grabbable.prototype._changeState=function(t){this._secsSinceStateChange=0,this._state=t},Grabbable.DECELERATION_TIME=1,Grabbable.DECELERATION_CURVE=.9,Grabbable.DELAY_BEFORE_BOB=.3,Grabbable.velocity=new pc.Vec3,Grabbable.newPosition=new pc.Vec3,Grabbable.updatedRotation=new pc.Quat,Grabbable.prototype._updateStateIdle=function(t){Grabbable.updatedRotation;var e=Grabbable.velocity,a=Grabbable.newPosition;if(this._prevPosition.copy(this.entity.getPosition()),this._controller)this._controller.updateAttachment(this.entity,this._grabRotationOffset);else if(this._wasGrabbed){this._secsSinceReleased+=t;var i=Math.min(this._secsSinceReleased/Grabbable.DECELERATION_TIME,1);if(e.lerp(this._releasedVelocity,pc.util.DEFAULT_VEC3_0,pc.util.unitCurve(i,Grabbable.DECELERATION_CURVE)),e.scale(t),this._secsSinceReleased<=Grabbable.DECELERATION_TIME&&this._positionWithoutBob.add(e),a.copy(this._positionWithoutBob),this._secsSinceReleased>=Grabbable.DELAY_BEFORE_BOB){var s=(this._secsSinceReleased-Grabbable.DELAY_BEFORE_BOB)%Grabbable.BOB_ANIM_LENGTH/Grabbable.BOB_ANIM_LENGTH*(2*Math.PI),b=Math.sin(s)*Grabbable.BOB_HEIGHT;a.y+=b}this.entity.setPosition(a),this._secsSinceReleased>=Grabbable.RESET_TIMEOUT&&(this._removeHighlight(this.entity),this._changeState(Grabbable.STATE_RESET_TELEPORT_OUT))}},Grabbable.TELEPORT_ANIM_LENGTH=.2,Grabbable.SMALLEST_SCALE=new pc.Vec3(.001,.001,.001),Grabbable.updatedScale=new pc.Vec3,Grabbable.prototype._updateStateResetTeleportOut=function(t){var e=Math.min(this._secsSinceStateChange/Grabbable.TELEPORT_ANIM_LENGTH,1),a=Grabbable.updatedScale;a.lerp(this._startLocalTransform.getScale(),Grabbable.SMALLEST_SCALE,e),this.entity.setLocalScale(a),this._secsSinceStateChange>=Grabbable.TELEPORT_ANIM_LENGTH&&(this.entity.setLocalPosition(this._startLocalTransform.getTranslation()),this.entity.setLocalEulerAngles(this._startLocalTransform.getEulerAngles()),this._changeState(Grabbable.STATE_RESET_TELEPORT_IN))},Grabbable.prototype._updateStateResetTeleportIn=function(t){var e=Math.min(this._secsSinceStateChange/Grabbable.TELEPORT_ANIM_LENGTH,1),a=Grabbable.updatedScale;a.lerp(Grabbable.SMALLEST_SCALE,this._startLocalTransform.getScale(),e),this.entity.setLocalScale(a),this._secsSinceStateChange>=Grabbable.TELEPORT_ANIM_LENGTH&&(this._secsSinceReleased=0,this._wasGrabbed=!1,this._changeState(Grabbable.STATE_IDLE))},Grabbable.prototype._onHover=function(){this._isIdle()&&this._addHighlight(this.entity)},Grabbable.prototype._offHover=function(){this._isIdle()&&this._removeHighlight(this.entity)},Grabbable.prototype._onHold=function(t){this._isIdle()&&(this._controller&&this._controller.detach(this.entity),this._controller=t,this._grabRotationOffset.copy(t.getAttachRotation()).invert().mul(this.entity.getRotation()),t.attach(this.entity),this._removeHighlight(this.entity))},Grabbable.RELEASE_VELOCITY_FACTOR=10,Grabbable.MAX_RELEASE_VELOCITY=2.5,Grabbable.prototype._onRelease=function(t){this._isIdle()&&(this._controller==t&&(this._controller.detach(this.entity),this._controller=null,this._secsSinceReleased=0,this._wasGrabbed=!0,this._releasedVelocity.sub2(this.entity.getPosition(),this._prevPosition).scale(Grabbable.RELEASE_VELOCITY_FACTOR),this._releasedVelocity.length()>Grabbable.MAX_RELEASE_VELOCITY&&this._releasedVelocity.normalize().scale(Grabbable.MAX_RELEASE_VELOCITY),this._positionWithoutBob.copy(this.entity.getPosition())))},Grabbable.prototype._hasMoved=function(){return this._wasGrabbed},Grabbable.prototype._isIdle=function(){return this._state==Grabbable.STATE_IDLE},Grabbable.prototype._addHighlight=function(t){pc.util.setEntityEmissive(t,pc.util.HIGHLIGHT_ENTITY_GREEN);for(var e=t.children,a=0;a<e.length;++a)this._addHighlight(e[a])},Grabbable.prototype._removeHighlight=function(t){pc.util.setEntityEmissive(t,pc.util.HIGHLIGHT_ENTITY_DEFAULT);for(var e=t.children,a=0;a<e.length;++a)this._removeHighlight(e[a])};var Hifi=pc.createScript("hifi");Hifi.attributes.add("rotateSpeed",{type:"number",default:10,title:"Rotate Speed"}),Hifi.attributes.add("leftSpeakerEntity",{type:"entity",title:"Left Speaker Entity"}),Hifi.attributes.add("rightSpeakerEntity",{type:"entity",title:"Right Speaker Entity"}),Hifi.attributes.add("idleNeedleRotation",{type:"number",default:0,title:"Idle Needle Rotation"}),Hifi.attributes.add("startNeedleRotation",{type:"number",default:0,title:"Start Needle Rotation"}),Hifi.attributes.add("endNeedleRotation",{type:"number",default:0,title:"End Needle Rotation"}),Hifi.prototype.initialize=function(){pc.util.initSoundSlotAssets(this.app,this.entity),this.entity.on("interactswith:attachobject",this._onAttachObject,this),this.entity.on("interactswith:detachobject",this._onDetachObject,this),this._attachPointEntity=this.entity.findByName("Attach Point"),this._interactsWith=this.entity.script.interactsWith,this._currentNeedleRotation=this.idleNeedleRotation,this._rangeNeedleRotation=this.endNeedleRotation-this.startNeedleRotation,this._soundSlot=null,this._speakerCones=[];var t=0,e=this.leftSpeakerEntity.children;for(t=0;t<e.length;++t)childScript=e[t].script,childScript&&childScript.speakerCone&&this._speakerCones.push(childScript.speakerCone);for(e=this.rightSpeakerEntity.children,t=0;t<e.length;++t)childScript=e[t].script,childScript&&childScript.speakerCone&&this._speakerCones.push(childScript.speakerCone);this._needleModel=this.entity.findByName("Needle Model")},Hifi.VOLUME_CAP=55,Hifi.NEEDLE_LERP_FACTOR=12,Hifi.conePosition=new pc.Vec3,Hifi.prototype.update=function(t){this._attachPointEntity.rotateLocal(0,this.rotateSpeed*t,0);var e=this.idleNeedleRotation;if(null!==this._soundSlot){var i=0,n=this.entity.script.audioAnalyser,s=n.freqData,o=0;for(i=0;i<s.length;++i){var a=(s[i]-n.freqOffset)*n.freqScale;o+=a>0?a:0}var l=Math.min(o,Hifi.VOLUME_CAP)/Hifi.VOLUME_CAP;for(i=0;i<this._speakerCones.length;++i)this._speakerCones[i].applyVolume(l);if(this._soundSlot.instances&&this._soundSlot.instances[0]){var r=this._soundSlot.instances[0].currentTime,h=this._soundSlot.instances[0].duration;if(h>0){var d=r/h;e=this._rangeNeedleRotation*d+this.startNeedleRotation}}}this._currentNeedleRotation=pc.math.lerp(this._currentNeedleRotation,e,Math.min(Hifi.NEEDLE_LERP_FACTOR*t,1)),this._needleModel.setLocalEulerAngles(0,this._currentNeedleRotation,0)},Hifi.prototype._onAttachObject=function(t){var e=t.getHeldEntity(),i=e.script?e.script.vinyl:null,n=this.entity.script.audioAnalyser;i&&(this._soundSlot=pc.util.playSoundSlot(this.entity,i.soundSlotName),this._soundSlot&&n.assignSoundSlot(this._soundSlot))},Hifi.prototype._onDetachObject=function(t){this._soundSlot&&(pc.util.stopSoundSlot(this.entity,this._soundSlot.name),this._soundSlot=null);for(var e=0;e<this._speakerCones.length;++e)this._speakerCones[e].applyVolume(0)};var InteractsWith=pc.createScript("interactsWith");InteractsWith.attributes.add("presetEntity",{type:"entity",title:"Preset Entity",description:"Entity to be attached to this on start"}),InteractsWith.attributes.add("compatibleTag",{type:"string",default:"",title:"Compatible Tag",description:"Tag that this object can interact with"}),InteractsWith.STATE_IDLE="IDLE",InteractsWith.STATE_IN_USE="IN_USE",InteractsWith.prototype.attach=function(t){this._heldEntity=t,this.entity.fire("interactswith:attachobject",this),this._state=InteractsWith.STATE_IN_USE},InteractsWith.prototype.detach=function(t){this.entity.fire("interactswith:detachobject",this),this._heldEntity=null,this._state=InteractsWith.STATE_IDLE},InteractsWith.prototype.getAttachPosition=function(){return this._attachPointEntity.getPosition()},InteractsWith.prototype.getAttachRotation=function(){return this._attachPointEntity.getRotation()},InteractsWith.prototype.updateAttachment=function(t,i){t.setPosition(this._attachPointEntity.getPosition()),t.setRotation(this._attachPointEntity.getRotation())},InteractsWith.prototype.getHeldEntity=function(){return this._heldEntity},InteractsWith.prototype.initialize=function(){this._heldEntity=null,this._state=InteractsWith.STATE_IDLE,this.entity.on("object:onhover",this._onHover,this),this.entity.on("object:offhover",this._offHover,this),this.entity.on("object:attemptuse",this._onAttemptUse,this),this._attachPointEntity=this.entity.findByName("Attach Point")},InteractsWith.prototype.postInitialize=function(){this.presetEntity&&this._isCompatible(this.presetEntity)&&this.presetEntity.fire("object:hold",this)},InteractsWith.prototype.update=function(t){switch(this._state){case InteractsWith.STATE_IDLE:this._updateStateIdle(t);break;case InteractsWith.STATE_IN_USE:this._updateStateInUse(t)}},InteractsWith.prototype._updateStateIdle=function(t){},InteractsWith.prototype._updateStateInUse=function(t){},InteractsWith.prototype._onHover=function(t){if(this._isIdle()){var i=t.getHeldEntity();i?this._isCompatible(i)?this._addHighlight(this.entity,!0):this._addHighlight(this.entity,!1):this._removeHighlight(this.entity)}},InteractsWith.prototype._offHover=function(t){this._isIdle()&&this._removeHighlight(this.entity)},InteractsWith.prototype._onAttemptUse=function(t){if(this._isIdle()){var i=t.getHeldEntity();this._isCompatible(i)?i.fire("object:hold",this):i.fire("object:release",t),this._removeHighlight(this.entity)}},InteractsWith.prototype._isIdle=function(){return this._state==InteractsWith.STATE_IDLE},InteractsWith.prototype._isCompatible=function(t){return!(!t||!t.tags.has(this.compatibleTag))},InteractsWith.prototype._addHighlight=function(t,i){i?pc.util.setEntityEmissive(t,pc.util.HIGHLIGHT_ENTITY_GREEN):pc.util.setEntityEmissive(t,pc.util.HIGHLIGHT_ENTITY_RED);for(var e=t.children,n=0;n<e.length;++n)this._addHighlight(e[n],i)},InteractsWith.prototype._removeHighlight=function(t){pc.util.setEntityEmissive(t,pc.util.HIGHLIGHT_ENTITY_DEFAULT);for(var i=t.children,e=0;e<i.length;++e)this._removeHighlight(i[e])};var LocatorRings=pc.createScript("locatorRings");LocatorRings.attributes.add("animLength",{type:"number",default:1,title:"Anim Length (secs)"}),LocatorRings.attributes.add("loopGap",{type:"number",default:1,title:"Loop Gap (secs)"}),LocatorRings.attributes.add("yOffsetCurve",{type:"curve",title:"Y Offset Curve"}),LocatorRings.attributes.add("scaleOffsetCurve",{type:"curve",title:"Scale Offset Curve"}),LocatorRings.attributes.add("alphaCurve",{type:"curve",title:"Alpha Curve"}),LocatorRings.prototype.initialize=function(){this._rings=this.entity.findByTag("locator-ring"),this._ringCount=this._rings.length,this._time=0,this._targetScaleY=1,this._setScaleY(.001),this.on("state",this._onStateChanged,this)},LocatorRings.ringPosition=new pc.Vec3,LocatorRings.SCALE_LERP_FACTOR=8,LocatorRings.prototype.update=function(t){var e=this._time/this.animLength,i=LocatorRings.ringPosition;LocatorRings.ringScale;if(e<=1)for(var a=0;a<this._ringCount;++a){var s=(e+1/this._ringCount*a)%1,o=this._rings[a];i.copy(o.getLocalPosition()),i.y=this.yOffsetCurve.value(s),o.setLocalPosition(i);var n=this.scaleOffsetCurve.value(s);o.setLocalScale(n,n,n),pc.util.setEntityAlpha(o,this.alphaCurve.value(s))}this._time=(this._time+t)%(this.animLength+this.loopGap);var r=this.entity.getLocalScale();this._setScaleY(pc.math.lerp(r.y,this._targetScaleY,Math.min(LocatorRings.SCALE_LERP_FACTOR*t,1)))},LocatorRings.prototype._onStateChanged=function(t){t&&(this._setScaleY(.001),this._targetScaleY=1)},LocatorRings.prototype._setScaleY=function(t){var e=this.entity.getLocalScale();e.y=t,this.entity.setLocalScale(e)};var LookCamera=pc.createScript("lookCamera");LookCamera.attributes.add("mouseSensivity",{title:"Mouse Sensivity",type:"number",default:.3}),LookCamera.attributes.add("controllerTemplate",{title:"Controller Template",type:"asset",assetType:"template"}),LookCamera.prototype.initialize=function(){this._offsetParent=this.entity.parent;var t=this.entity.getRotation();this.yaw=pc.util.getYaw(t),this.pitch=this._getPitch(t,this.yaw),this.movedMouse=0,this.movedStart=0,this.touchCoords=new pc.Vec2,this.app.mouse.on(pc.EVENT_MOUSEDOWN,this._onMouseDown,this),this.app.mouse.on(pc.EVENT_MOUSEUP,this._onMouseUp,this),this.app.mouse.on(pc.EVENT_MOUSEMOVE,this._onMouseMove,this),this.app.mouse.disableContextMenu(),this.app.touch&&(this.app.touch.on(pc.EVENT_TOUCHSTART,this._onTouchStart,this),this.app.touch.on(pc.EVENT_TOUCHEND,this._onTouchEndCancel,this),this.app.touch.on(pc.EVENT_TOUCHCANCEL,this._onTouchStartEndCancel,this),this.app.touch.on(pc.EVENT_TOUCHMOVE,this._onTouchMove,this)),this.app.mainCamera=this.entity,this.gazeController=null,this.app.xr.active||(this.gazeController=this.controllerTemplate.resource.instantiate(),this.gazeController.reparent(this.app.root),this.gazeController.enabled=!0),this.app.xr.on("start",(function(){this.gazeController&&(this.gazeController.destroy(),this.gazeController=null)}),this),this.app.xr.on("end",(function(){this.gazeController||(this.gazeController=this.controllerTemplate.resource.instantiate(),this.gazeController.reparent(this.app.root),this.gazeController.enabled=!0)}),this)},LookCamera.prototype._onMouseDown=function(t){this.app.xr.active||(pc.Mouse.isPointerLocked()||t.event.target.id&&"application-canvas"==t.event.target.id&&this.app.mouse.enablePointerLock(),t.button===pc.MOUSEBUTTON_LEFT&&(this.movedStart=Date.now(),this.movedMouse=0,this.gazeController&&this.gazeController.script.controller.onSelectStart()))},LookCamera.prototype._onTouchStart=function(t){this.app.xr.active||(t.event.preventDefault(),1===t.touches.length&&(this.movedStart=Date.now(),this.movedMouse=0,this.touchCoords.set(t.touches[0].x,t.touches[0].y),this.gazeController&&(this.gazeController.script.controller.active=!0,this.gazeController.script.controller.mouseCoords.set(t.touches[0].x,t.touches[0].y),this.gazeController.script.controller.onSelectStart())))},LookCamera.prototype._onMouseUp=function(t){this.app.xr.active||t.button===pc.MOUSEBUTTON_LEFT&&this.gazeController&&(!pc.Mouse.isPointerLocked()&&(this.movedMouse>30||Date.now()-this.movedStart>300)&&(this.gazeController.script.controller.teleportable=!1),this.gazeController.script.controller.onSelectEnd(),this.gazeController.script.controller.teleportable=!0)},LookCamera.prototype._onTouchEndCancel=function(t){this.app.xr.active||0===t.touches.length&&this.gazeController&&((this.movedMouse>30||Date.now()-this.movedStart>300)&&(this.gazeController.script.controller.teleportable=!1),this.gazeController.script.controller.onSelectEnd(),this.gazeController.script.controller.teleportable=!0,this.gazeController.script.controller.active=!1)},LookCamera.prototype._onMouseMove=function(t){this.app.xr.active||(this.gazeController&&(this.gazeController.script.controller.mouseCoords.set(t.x,t.y),this.gazeController.script.controller.active=!0),!pc.Mouse.isPointerLocked()&&(!this.app.mouse.isPressed(pc.MOUSEBUTTON_LEFT)||this.gazeController&&this.gazeController.script.controller.getHeldEntity())||(this.pitch=Math.max(-90,Math.min(90,this.pitch-t.dy*this.mouseSensivity)),this.yaw-=t.dx*this.mouseSensivity,this.movedMouse+=Math.abs(t.dy)+Math.abs(t.dx)))},LookCamera.prototype._onTouchMove=function(t){if(!this.app.xr.active&&1===t.touches.length&&(this.gazeController&&this.gazeController.script.controller.mouseCoords.set(t.touches[0].x,t.touches[0].y),!this.gazeController||!this.gazeController.script.controller.getHeldEntity())){var e=t.touches[0].x-this.touchCoords.x,o=t.touches[0].y-this.touchCoords.y;this.touchCoords.set(t.touches[0].x,t.touches[0].y),this.pitch=Math.max(-90,Math.min(90,this.pitch-o*this.mouseSensivity)),this.yaw-=e*this.mouseSensivity,this.movedMouse+=Math.abs(o)+Math.abs(e)}},LookCamera.prototype.update=function(t){this._offsetParent.setLocalEulerAngles(0,this.yaw,0),this.app.xr.active||this.entity.setLocalEulerAngles(this.pitch,0,0)},LookCamera.quatWithoutYaw=new pc.Quat,LookCamera.yawOffset=new pc.Quat,LookCamera.prototype._getPitch=function(t,e){var o=LookCamera.quatWithoutYaw,s=LookCamera.yawOffset;s.setFromEulerAngles(0,-e,0),o.mul2(s,t);var r=new pc.Vec3;return o.transformVector(pc.Vec3.FORWARD,r),Math.atan2(r.y,-r.z)*pc.math.RAD_TO_DEG};var SpeakerCone=pc.createScript("speakerCone");SpeakerCone.MAX_DISPLACEMENT=.02,SpeakerCone.MAX_SCALE_RANGE=.1,SpeakerCone.volumeDisplacement=new pc.Vec3,SpeakerCone.volumeScale=new pc.Vec3,SpeakerCone.prototype.applyVolume=function(e){var t=SpeakerCone.volumeDisplacement;t.copy(this.entity.forward).scale(e*SpeakerCone.MAX_DISPLACEMENT),t.add(this._startLocalPosition);var a=SpeakerCone.volumeScale,o=SpeakerCone.MAX_SCALE_RANGE*e;o+=pc.math.random(-SpeakerCone.MAX_DISPLACEMENT/5,SpeakerCone.MAX_DISPLACEMENT/5),a.set(o,o,o),a.add(this._startLocalScale),this.entity.setLocalPosition(t),this.entity.setLocalScale(a)},SpeakerCone.prototype.initialize=function(){this._startLocalPosition=this.entity.getLocalPosition().clone(),this._startLocalScale=this.entity.getLocalScale().clone()};var StatueButton=pc.createScript("statueButton");StatueButton.attributes.add("startPosition",{type:"vec3",default:[0,0,0],title:"Start Position"}),StatueButton.attributes.add("pressedPosition",{type:"vec3",default:[0,0,0],title:"Pressed Position"}),StatueButton.attributes.add("statueEntity",{type:"entity",title:"Statue Entity"}),StatueButton.prototype.initialize=function(){this.entity.on("button:activated",this._onButtonActivated,this),this.entity.on("button:reseted",this._onButtonReseted,this),this._model=this.entity.findByName("Model"),this._activated=!1},StatueButton.LERP_FACTOR=18,StatueButton.prototype.update=function(t){var e=this._model.getLocalPosition();this._activated?e.lerp(e,this.pressedPosition,Math.min(StatueButton.LERP_FACTOR*t,1)):e.lerp(e,this.startPosition,Math.min(StatueButton.LERP_FACTOR*t,1)),this._model.setLocalPosition(e)},StatueButton.prototype._onButtonActivated=function(){this.statueEntity.fire("statue:activate"),this._activated=!0},StatueButton.prototype._onButtonReseted=function(){this._activated=!1};var Statue=pc.createScript("statue");Statue.attributes.add("soundSlotName",{type:"string",default:"",title:"Sound Slot Name"}),Statue.prototype.initialize=function(){this._audioEntity=this.entity.findByName("Sound"),pc.util.initSoundSlotAssets(this.app,this._audioEntity),this._particles=this.entity.findByName("Particle System"),this.entity.on("statue:activate",this._onActivate,this)},Statue.prototype._onActivate=function(){pc.util.playSoundSlot(this._audioEntity,this.soundSlotName),this._secsSinceActivation=0,this._playParticleEffect(this._particles)},Statue.prototype._playParticleEffect=function(t){for(var i=t.children,e=0;e<i.length;e++)i[e].particlesystem.reset(),i[e].particlesystem.play()};var Vinyl=pc.createScript("vinyl");Vinyl.attributes.add("soundSlotName",{type:"string",default:"",title:"Sound Slot Name",description:"Name of slot to play on Hifi"});var Vr=pc.createScript("vr");Vr.attributes.add("buttonVr",{type:"entity",title:"VR Button"}),Vr.attributes.add("elementUnsupported",{type:"entity",title:"Unsupported Message"}),Vr.attributes.add("elementUnavailable",{type:"entity",title:"Unavailable Message"}),Vr.attributes.add("elementHttpsRequired",{type:"entity",title:"HTTPS Required Message"}),Vr.attributes.add("cameraEntity",{type:"entity",title:"Camera"}),Vr.prototype.initialize=function(){this.app.xr.on("available:"+pc.XRTYPE_VR,this.checkButton,this),this.app.xr.on("start",this.checkButton,this),this.app.xr.on("end",this.checkButton,this),this.buttonVr.element.on("click",(function(){this.sessionStart()}),this),this.app.keyboard.on("keydown",(function(t){t.key===pc.KEY_ESCAPE&&this.app.xr.active&&this.app.xr.end()}),this),this.checkButton()},Vr.prototype.checkButton=function(){if(this.app.xr.supported)if(this.elementHttpsRequired.enabled=!1,this.elementUnsupported.enabled=!1,this.elementUnavailable.enabled=!1,this.app.xr.active)this.buttonVr.enabled=!1;else{var t=this.app.xr&&!this.app.xr.active&&this.app.xr.isAvailable(pc.XRTYPE_VR);this.buttonVr.enabled=t,t||(this.elementUnavailable.enabled=!0)}else this.buttonVr.enabled=!1,this.elementUnavailable.enabled=!1,"https:"==window.location.protocol?(this.elementUnsupported.enabled=!0,this.elementHttpsRequired.enabled=!1):(this.elementUnsupported.enabled=!1,this.elementHttpsRequired.enabled=!0)},Vr.prototype.sessionStart=function(){this.app.xr.supported&&(this.app.xr.active||this.app.xr.isAvailable(pc.XRTYPE_VR)&&(window.DeviceOrientationEvent&&window.DeviceOrientationEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(function(t){"granted"===t&&window.addEventListener("deviceorientation",function(t){this.cameraEntity.camera.startXr(pc.XRTYPE_VR,pc.XRSPACE_LOCALFLOOR)}.bind(this))}.bind(this)).catch(console.error):this.cameraEntity.camera.startXr(pc.XRTYPE_VR,pc.XRSPACE_LOCALFLOOR)))};var Controllers=pc.createScript("controllers");Controllers.attributes.add("controllerTemplate",{type:"asset",assetType:"template",title:"Controller Template"}),Controllers.prototype.initialize=function(){this.controllerAssets=this.app.assets.findByTag("controller"),this.controllerAssetsIndex={};for(var e=0;e<this.controllerAssets.length;e++){var t=this.controllerAssets[e].name.replace(/\.[a-z]+$/i,"");this.controllerAssetsIndex[t]=this.controllerAssets[e]}this.app.xr.input.on("add",(function(e){for(var t=this.controllerTemplate.resource.instantiate(),r=null,s=0;s<e.profiles.length;s++){var l=e.profiles[s]+"-"+e.handedness;if(r=this.controllerAssetsIndex[l])break}r||(r=this.controllerAssetsIndex["generic-trigger-"+(e.handedness||"none")]),t.reparent(this.app.root),t.script.controller.setInputSource(e,r),t.enabled=!0}),this)};var Controller=pc.createScript("controller");Controller.attributes.add("maxGrabDistance",{type:"number",title:"Max Grab Distance",default:.1}),Controller.prototype.initialize=function(){this.ray=new pc.Ray,this.vecA=new pc.Vec3,this.vecB=new pc.Vec3,this.quat=new pc.Quat,this.color=new pc.Color(1,1,1),this.holdingEntity=null,this.teleportableEntity=null,this.hoverEntity=null,this.hoverPoint=new pc.Vec3,this.teleportable=!0,this.active=!0,this.mouseCoords=new pc.Vec2,this.holdingDistance=0,this.holdingOffset=new pc.Vec3,this.holdingNoOffset=!0,this.modelEntity=this.entity.findByName("Model"),this.grabAnchor=new pc.Entity,this.grabAnchor.reparent(this.entity)},Controller.prototype.setInputSource=function(t,i){var e=this;if(this.inputSource=t,this.inputSource.once("remove",this.onRemove,this),this.on("hover",this.onHover,this),this.on("blur",this.onBlur,this),this.inputSource.on("selectstart",this.onSelectStart,this),this.inputSource.on("selectend",this.onSelectEnd,this),t.hand){this.joints=[];for(var o=new pc.StandardMaterial,s=0;s<t.hand.joints.length;s++){var n=t.hand.joints[s],h=new pc.Entity;h.addComponent("model",{type:"box"}),h.joint=n,h.model.material=o,this.joints.push(h),this.entity.addChild(h)}t.hand.on("trackinglost",(function(){this.joints[0].model.material.diffuse.set(1,0,0),this.joints[0].model.material.update()}),this),t.hand.on("tracking",(function(){this.joints[0].model.material.diffuse.set(1,1,1),this.joints[0].model.material.update()}),this)}else i&&(i.ready((function(){if(this.entity.parent){var t=i.resource,o=new Blob([t]);this.app.assets.loadFromUrlAndFilename(URL.createObjectURL(o),"container.glb","container",(function(t,i){if(!e.entity.parent)return i.unload(),void e.app.assets.remove(i);t?console.error(t):(e.modelEntity.setLocalScale(1,1,1),e.modelEntity.model.type="asset",e.modelEntity.model.asset=i.resource.model,e.modelEntity.containerAsset=i)}))}}),this),this.app.assets.load(i))},Controller.prototype.onRemove=function(){this.modelEntity.containerAsset&&(console.log(this.modelEntity.containerAsset),this.modelEntity.containerAsset.unload(),this.app.assets.remove(this.modelEntity.containerAsset),this.modelEntity.containerAsset=null),this.entity.destroy()},Controller.prototype.onSelectStart=function(){this.pick(),this.teleportableEntity?this.app.xr.active&&this.app.fire("teleport:to",this.hoverPoint):this.hoverEntity&&!this.holdingEntity&&(this.hoverEntity.fire("object:interact",this),this.hoverEntity.fire("object:hold",this))},Controller.prototype.onSelectEnd=function(){this.teleportableEntity&&!this.app.xr.active&&this.teleportable&&this.app.fire("teleport:to",this.hoverPoint),this.hoverEntity&&this.hoverEntity.fire("object:attemptuse",this),this.holdingEntity&&this.holdingEntity.fire("object:release",this)},Controller.prototype.getAttachPosition=function(){return this.grabAnchor.getPosition()},Controller.prototype.getAttachRotation=function(){return this.grabAnchor.getRotation()},Controller.prototype.attach=function(t){this.holdingEntity||(this.holdingEntity=t,this.grabAnchor.setPosition(t.getPosition()),this.holdingDistance=t.getPosition().distance(this.app.mainCamera.getPosition()))},Controller.prototype.detach=function(t){this.holdingEntity&&(this.holdingEntity=null)},Controller.prototype.getHeldEntity=function(){return this.holdingEntity},Controller.prototype.updateAttachment=function(t,i){t.setPosition(this.getAttachPosition()),this.quat.mul2(this.getAttachRotation(),i),t.setRotation(this.quat)},Controller.prototype.filterPicker=function(t){return this.holdingEntity!==t},Controller.prototype.pick=function(){this.inputSource?this.ray.set(this.inputSource.getOrigin(),this.inputSource.getDirection()):pc.Mouse.isPointerLocked()?this.ray.set(this.app.mainCamera.getPosition(),this.app.mainCamera.forward):(this.app.mainCamera.camera.screenToWorld(this.mouseCoords.x,this.mouseCoords.y,this.app.mainCamera.camera.nearClip,this.vecA),this.app.mainCamera.camera.screenToWorld(this.mouseCoords.x,this.mouseCoords.y,this.app.mainCamera.camera.farClip,this.vecB),this.vecB.sub(this.vecA).normalize(),this.ray.set(this.vecA,this.vecB),this.holdingEntity?(this.vecB.scale(this.holdingDistance),this.vecB.add(this.vecA),this.holdingNoOffset&&(this.holdingNoOffset=!1,this.holdingOffset.copy(this.grabAnchor.getPosition()).sub(this.vecB)),this.vecB.add(this.holdingOffset),this.grabAnchor.setPosition(this.vecB)):this.holdingNoOffset=!0);var t=this.app.shapeWorld.raycast(this.ray,this.filterPicker.bind(this),this.hoverPoint),i=!1;(this.active||(t=null),this.hoverEntity!==t&&(this.hoverEntity&&this.hoverEntity.fire("object:offhover",this),t&&t.fire("object:onhover",this),this.hoverEntity=t),this.hoverEntity)&&(this.holdingEntity||this.hoverEntity.tags.has("floor")&&this.hoverEntity.up.dot(this.ray.direction)<=0&&(i=!0));this.teleportableEntity=i?this.hoverEntity:null},Controller.prototype.update=function(t){if(this.inputSource&&"gaze"!==this.inputSource.targetRayMode&&(this.vecA.copy(this.inputSource.getOrigin()),this.vecB.copy(this.inputSource.getDirection()),this.vecB.scale(1e3).add(this.vecA),this.inputSource.selecting?this.color.set(0,1,0):this.color.set(1,1,1),this.app.renderLine(this.vecA,this.vecB,this.color)),this.inputSource&&this.inputSource.hand)for(var i=0;i<this.joints.length;i++){var e=this.joints[i].joint,o=2*e.radius;this.joints[i].setLocalScale(o,o,o),this.joints[i].setPosition(e.getPosition()),this.joints[i].setRotation(e.getRotation())}else this.inputSource&&this.inputSource.grip?(this.modelEntity.enabled=!0,this.entity.setPosition(this.inputSource.getPosition()),this.entity.setRotation(this.inputSource.getRotation())):(this.modelEntity.enabled=!1,this.inputSource&&"gaze"!==this.inputSource.targetRayMode||(this.entity.setPosition(this.app.mainCamera.getPosition()),this.entity.setRotation(this.app.mainCamera.getRotation())));this.pick(),this.teleportableEntity?(this.vecB.copy(this.hoverEntity.up).scale(.01),this.vecA.copy(this.hoverPoint).add(this.vecB),this.app.fire("teleport:transform",this.vecA,this.hoverEntity.getRotation()),this.app.fire("teleport:show")):this.app.fire("teleport:hide")};var Teleport=pc.createScript("teleport");Teleport.prototype.initialize=function(){this.app.on("teleport:show",(function(){this.entity.enabled=!0}),this),this.app.on("teleport:hide",(function(){this.entity.enabled=!1}),this),this.app.on("teleport:transform",(function(t,e){this.entity.setPosition(t),this.entity.setRotation(e)}),this)};var TeleportCamera=pc.createScript("teleportCamera");TeleportCamera.prototype.initialize=function(){this.app.on("teleport:to",(function(t){this.entity.setPosition(t)}),this)};var Rotate=pc.createScript("rotate earth");Rotate.attributes.add("speed",{type:"number",default:1}),Rotate.prototype.initialize=function(){},Rotate.prototype.update=function(t){this.entity.rotateLocal(0,t*this.speed,0)},Rotate.prototype.swap=function(t){};var ShaderChunk=pc.createScript("shaderChunk");ShaderChunk.attributes.add("chunkName",{type:"string"}),ShaderChunk.attributes.add("shader",{type:"asset",assetType:"shader"}),ShaderChunk.prototype.initialize=function(){var e=this.entity.model.meshInstances[0].material;this.shader&&(e.chunks[this.chunkName+"PS"]=this.shader.resource),this.shader.on("load",(function(){e.chunks[this.chunkName+"PS"]=this.resource,e.update()})),e.update()};function loadScene(e,n,c,l){var a=pc.Application.getApplication(),o=a.scenes.find(e);if(o){var t=o.loaded;a.scenes.loadSceneData(o,(function(e,o){if(e)c&&c.call(l,e);else{for(var i=null,s=a.root.children;s.length>0;)s[0].destroy();n.settings&&a.scenes.loadSceneSettings(o,(function(e){e&&c&&c.call(l,e)})),n.hierarchy&&a.scenes.loadSceneHierarchy(o,(function(e,n){e?c&&c(e):i=n})),t||a.scenes.unloadSceneData(o),c&&c.call(l,null,i)}}))}else c&&c.call(l,"Scene not found: "+e)}var ChangeSceneOnClick=pc.createScript("changeSceneOnClick");ChangeSceneOnClick.attributes.add("sceneName",{type:"string"}),ChangeSceneOnClick.prototype.initialize=function(){this.entity.button.once("click",(function(){loadScene(this.sceneName,{hierarchy:!0,settings:!1})}),this)};var CameraMovement=pc.createScript("cameraMovement");CameraMovement.attributes.add("mouseSpeed",{type:"number",default:1.4,description:"Mouse Sensitivity"}),CameraMovement.attributes.add("touchSensitivity",{type:"number",default:5,description:"Touch Sensitivity"}),CameraMovement.prototype.initialize=function(){this.eulers=new pc.Vec3,this.touchCoords=new pc.Vec2;var t=this.app;t.mouse.on("mousemove",this.onMouseMove,this),t.mouse.on("mousedown",(function(){t.mouse.enablePointerLock()}),this),this.lastLTouchPoint=new pc.Vec2,this.LTouchStartPoint=new pc.Vec2,this.LTouch=null,this.Rid=-1,this.Lid=-1,this.velZ=0,this.velX=0,this.rayEnd=t.root.findByName("RaycastEndPoint"),t.touch&&(t.touch.on(pc.EVENT_TOUCHSTART,this.onTouchStart,this),t.touch.on(pc.EVENT_TOUCHEND,this.onTouchEnd,this),t.touch.on(pc.EVENT_TOUCHCANCEL,this.onTouchEnd,this),t.touch.on(pc.EVENT_TOUCHMOVE,this.onTouchMove,this))},CameraMovement.prototype.update=function(t){this.velZ=-1!=this.Lid?this.lastLTouchPoint.y-this.LTouchStartPoint.y:0,this.velX=-1!=this.Lid?this.lastLTouchPoint.x-this.LTouchStartPoint.x:0},CameraMovement.prototype.postUpdate=function(t){var i=this.entity.parent,o=this.eulers.x+180,e=this.eulers.y,s=new pc.Vec3(-e,o,0);i.setEulerAngles(s),this.entity.setPosition(this.getWorldPoint()),this.entity.lookAt(i.getPosition())},CameraMovement.prototype.onMouseMove=function(t){pc.Mouse.isPointerLocked()&&(this.eulers.x-=this.mouseSpeed*t.dx/60%360,this.eulers.y=Math.max(Math.min(this.eulers.y+this.mouseSpeed*t.dy/60%360,89.99),-89.99))},CameraMovement.prototype.onTouchStart=function(t){t.changedTouches.forEach((function(t){var i=this.app.graphicsDevice;t.x>.5*i.width/window.devicePixelRatio&&-1==this.Rid&&(this.Rid=t.id,this.touchCoords.set(t.x,t.y)),t.x<=.5*i.width/window.devicePixelRatio&&-1==this.Lid&&(this.Lid=t.id,this.LTouchStartPoint.set(t.x,t.y),this.lastLTouchPoint.set(t.x,t.y))}),this)},CameraMovement.prototype.onTouchEnd=function(t){t.changedTouches.forEach((function(t){this.Rid==t.id&&(this.Rid=-1),this.Lid==t.id&&(this.Lid=-1)}),this)},CameraMovement.prototype.onTouchMove=function(t){if(this.RTouch=t.getTouchById(this.Rid,t.touches),this.LTouch=t.getTouchById(this.Lid,t.touches),this.RTouch){var i=(this.RTouch.x-this.touchCoords.x)*this.touchSensitivity,o=(this.RTouch.y-this.touchCoords.y)*this.touchSensitivity;this.eulers.x-=this.touchSensitivity*i/60%360,this.eulers.y+=this.touchSensitivity*o/60%360,this.eulers.x<0&&(this.eulers.x+=360),this.eulers.y<0&&(this.eulers.y+=360),this.touchCoords.set(this.RTouch.x,this.RTouch.y)}this.LTouch&&this.lastLTouchPoint.set(this.LTouch.x,this.LTouch.y)},CameraMovement.prototype.getWorldPoint=function(){var t=this.entity.parent.getPosition(),i=this.rayEnd.getPosition(),o=this.app.systems.rigidbody.raycastFirst(t,i);return o?o.point:i};var PlayerMovement=pc.createScript("playerMovement");PlayerMovement.attributes.add("speed",{type:"number",default:.09}),PlayerMovement.prototype.initialize=function(){var e=this.app.root.findByName("Camera");this.cameraScript=e.script.cameraMovement,this.force=new pc.Vec3,this.forceX=new pc.Vec3,this.forceZ=new pc.Vec3},PlayerMovement.prototype.update=function(e){var t=this.app;this.force=pc.Vec3.ZERO.clone();var i=this.entity.forward,r=this.entity.right;if(t.keyboard.isPressed(pc.KEY_A)&&(this.force.x-=r.x,this.force.z-=r.z),t.keyboard.isPressed(pc.KEY_D)&&(this.force.x+=r.x,this.force.z+=r.z),t.keyboard.isPressed(pc.KEY_W)&&(this.force.x+=i.x,this.force.z+=i.z),t.keyboard.isPressed(pc.KEY_S)&&(this.force.x-=i.x,this.force.z-=i.z),this.forceX.copy(this.entity.right).scale(this.cameraScript.velX*this.speed),this.forceZ.copy(this.entity.forward).scale(-this.cameraScript.velZ*this.speed),this.cameraScript.LTouch&&(this.force=this.forceX.add(this.forceZ).normalize().scale(80)),0!==this.force.x||0!==this.force.z){var c=new pc.Vec3(this.force.x*e,0,this.force.z*e);c.normalize().scale(this.speed),c.add(this.entity.getPosition());var s=this.cameraScript.eulers.x+180,o=new pc.Vec3(0,s,0);this.entity.rigidbody.teleport(c,o)}};var PlayerAnimationHandler=pc.createScript("playerAnimationHandler");PlayerAnimationHandler.attributes.add("blendTime",{type:"number",default:.2}),PlayerAnimationHandler.attributes.add("velMin",{type:"number",default:10}),PlayerAnimationHandler.attributes.add("velMax",{type:"number",default:50}),PlayerAnimationHandler.prototype.initialize=function(){var i=this.app,t=i.root.findByName("Camera");this.cameraScript=t.script.cameraMovement,i.keyboard.on(pc.EVENT_KEYDOWN,this.keyChange,this),i.keyboard.on(pc.EVENT_KEYUP,this.keyChange,this),this.direction="Idle",this.setDirection("Idle")},PlayerAnimationHandler.prototype.update=function(i){if(this.cameraScript.LTouch){var t=this.direction;this.checkTouch(),t!==this.direction&&this.setDirection(this.direction)}},PlayerAnimationHandler.prototype.checkButtons=function(){var i=this.app,t=i.keyboard.isPressed(pc.KEY_W),e=i.keyboard.isPressed(pc.KEY_A),a=i.keyboard.isPressed(pc.KEY_S),r=i.keyboard.isPressed(pc.KEY_D);this.direction=t&&!a?e&&!r?"Run Forward Left":r&&!e?"Run Forward Right":"Run Forward":a&&!t?e&&!r?"Run Backward Left":r&&!e?"Run Backward Right":"Run Backward":e&&!r?"Run Left":r&&!e?"Run Right":"Idle"},PlayerAnimationHandler.prototype.checkTouch=function(){this.app;this.cameraScript.velZ<-this.velMax&&this.cameraScript.velX<-this.velMax?this.direction="Run Forward Left":this.cameraScript.velZ<-this.velMax&&this.cameraScript.velX>this.velMax?this.direction="Run Forward Right":this.cameraScript.velZ<0&&this.cameraScript.velX<this.velMax&&this.cameraScript.velX>-this.velMax?this.direction="Run Forward":this.cameraScript.velZ>this.velMax&&this.cameraScript.velX<-this.velMax?this.direction="Run Backward Left":this.cameraScript.velZ>this.velMax&&this.cameraScript.velX>this.velMax?this.direction="Run Backward Right":this.cameraScript.velZ>0&&this.cameraScript.velX<this.velMax&&this.cameraScript.velX>-this.velMax?this.direction="Run Backward":this.cameraScript.velZ<this.velMax&&this.cameraScript.velZ>-this.velMax&&this.cameraScript.velX<-this.velMin?this.direction="Run Left":this.cameraScript.velZ<this.velMax&&this.cameraScript.velZ>-this.velMax&&this.cameraScript.velX>this.velMin?this.direction="Run Right":this.direction="Idle"},PlayerAnimationHandler.prototype.keyChange=function(i){var t=this.direction;this.checkButtons(),t!==this.direction&&this.setDirection(this.direction)},PlayerAnimationHandler.prototype.setDirection=function(i){this.direction=i,this.entity.animation.play(i,this.blendTime)};var SAMPLE_COUNT=15;function computeGaussian(e,t){return 1/Math.sqrt(2*Math.PI*t)*Math.exp(-e*e/(2*t*t))}function calculateBlurValues(e,t,o,s,r){e[0]=computeGaussian(0,r),t[0]=0,t[1]=0;var i,l,a=e[0];for(i=0,l=Math.floor(SAMPLE_COUNT/2);i<l;i++){var u=computeGaussian(i+1,r);e[2*i]=u,e[2*i+1]=u,a+=2*u;var h=2*i+1.5;t[4*i]=o*h,t[4*i+1]=s*h,t[4*i+2]=-o*h,t[4*i+3]=-s*h}for(i=0,l=e.length;i<l;i++)e[i]/=a}function BloomEffect(e){pc.PostEffect.call(this,e);var t={aPosition:pc.SEMANTIC_POSITION},o=["attribute vec2 aPosition;","","varying vec2 vUv0;","","void main(void)","{","    gl_Position = vec4(aPosition, 0.0, 1.0);","    vUv0 = (aPosition + 1.0) * 0.5;","}"].join("\n"),s=["precision "+e.precision+" float;","","varying vec2 vUv0;","","uniform sampler2D uBaseTexture;","uniform float uBloomThreshold;","","void main(void)","{","    vec4 color = texture2D(uBaseTexture, vUv0);","","    gl_FragColor = clamp((color - uBloomThreshold) / (1.0 - uBloomThreshold), 0.0, 1.0);","}"].join("\n"),r=["precision "+e.precision+" float;","","#define SAMPLE_COUNT "+SAMPLE_COUNT,"","varying vec2 vUv0;","","uniform sampler2D uBloomTexture;","uniform vec2 uBlurOffsets[SAMPLE_COUNT];","uniform float uBlurWeights[SAMPLE_COUNT];","","void main(void)","{","    vec4 color = vec4(0.0);","    for (int i = 0; i < SAMPLE_COUNT; i++)","    {","        color += texture2D(uBloomTexture, vUv0 + uBlurOffsets[i]) * uBlurWeights[i];","    }","","    gl_FragColor = color;","}"].join("\n"),i=["precision "+e.precision+" float;","","varying vec2 vUv0;","","uniform float uBloomEffectIntensity;","uniform sampler2D uBaseTexture;","uniform sampler2D uBloomTexture;","","void main(void)","{","    vec4 bloom = texture2D(uBloomTexture, vUv0) * uBloomEffectIntensity;","    vec4 base = texture2D(uBaseTexture, vUv0);","","    base *= (1.0 - clamp(bloom, 0.0, 1.0));","","    gl_FragColor = base + bloom;","}"].join("\n");this.extractShader=new pc.Shader(e,{attributes:t,vshader:o,fshader:s}),this.blurShader=new pc.Shader(e,{attributes:t,vshader:o,fshader:r}),this.combineShader=new pc.Shader(e,{attributes:t,vshader:o,fshader:i}),this.targets=[],this.bloomThreshold=.25,this.blurAmount=4,this.bloomIntensity=1.25,this.sampleWeights=new Float32Array(SAMPLE_COUNT),this.sampleOffsets=new Float32Array(2*SAMPLE_COUNT)}BloomEffect.prototype=Object.create(pc.PostEffect.prototype),BloomEffect.prototype.constructor=BloomEffect,BloomEffect.prototype._destroy=function(){var e;if(this.targets)for(e=0;e<this.targets.length;e++)this.targets[e].destroyTextureBuffers(),this.targets[e].destroy();this.targets.length=0},BloomEffect.prototype._resize=function(e){var t,o=e.colorBuffer.width,s=e.colorBuffer.height;if(o!==this.width||s!==this.height)for(this.width=o,this.height=s,this._destroy(),t=0;t<2;t++){var r=new pc.Texture(this.device,{name:"Bloom Texture"+t,format:pc.PIXELFORMAT_R8_G8_B8_A8,width:o>>1,height:s>>1,mipmaps:!1});r.minFilter=pc.FILTER_LINEAR,r.magFilter=pc.FILTER_LINEAR,r.addressU=pc.ADDRESS_CLAMP_TO_EDGE,r.addressV=pc.ADDRESS_CLAMP_TO_EDGE,r.name="pe-bloom";var i=new pc.RenderTarget({name:"Bloom Render Target "+t,colorBuffer:r,depth:!1});this.targets.push(i)}},Object.assign(BloomEffect.prototype,{render:function(e,t,o){this._resize(e);var s=this.device,r=s.scope;r.resolve("uBloomThreshold").setValue(this.bloomThreshold),r.resolve("uBaseTexture").setValue(e.colorBuffer),pc.drawFullscreenQuad(s,this.targets[0],this.vertexBuffer,this.extractShader),calculateBlurValues(this.sampleWeights,this.sampleOffsets,1/this.targets[1].width,0,this.blurAmount),r.resolve("uBlurWeights[0]").setValue(this.sampleWeights),r.resolve("uBlurOffsets[0]").setValue(this.sampleOffsets),r.resolve("uBloomTexture").setValue(this.targets[0].colorBuffer),pc.drawFullscreenQuad(s,this.targets[1],this.vertexBuffer,this.blurShader),calculateBlurValues(this.sampleWeights,this.sampleOffsets,0,1/this.targets[0].height,this.blurAmount),r.resolve("uBlurWeights[0]").setValue(this.sampleWeights),r.resolve("uBlurOffsets[0]").setValue(this.sampleOffsets),r.resolve("uBloomTexture").setValue(this.targets[1].colorBuffer),pc.drawFullscreenQuad(s,this.targets[0],this.vertexBuffer,this.blurShader),r.resolve("uBloomEffectIntensity").setValue(this.bloomIntensity),r.resolve("uBloomTexture").setValue(this.targets[0].colorBuffer),r.resolve("uBaseTexture").setValue(e.colorBuffer),pc.drawFullscreenQuad(s,t,this.vertexBuffer,this.combineShader,o)}});var Bloom=pc.createScript("bloom");Bloom.attributes.add("bloomIntensity",{type:"number",default:1,min:0,title:"Intensity"}),Bloom.attributes.add("bloomThreshold",{type:"number",default:.25,min:0,max:1,title:"Threshold"}),Bloom.attributes.add("blurAmount",{type:"number",default:4,min:1,title:"Blur amount"}),Bloom.prototype.initialize=function(){this.effect=new BloomEffect(this.app.graphicsDevice),this.effect.bloomThreshold=this.bloomThreshold,this.effect.blurAmount=this.blurAmount,this.effect.bloomIntensity=this.bloomIntensity;var e=this.entity.camera.postEffects;e.addEffect(this.effect),this.on("attr",(function(e,t){this.effect[e]=t}),this),this.on("state",(function(t){t?e.addEffect(this.effect):e.removeEffect(this.effect)})),this.on("destroy",(function(){e.removeEffect(this.effect),this._destroy()}))};var Rotate=pc.createScript("rotate");Rotate.attributes.add("rotation",{type:"vec3",default:[0,1,0]}),Rotate.prototype.initialize=function(){},Rotate.prototype.update=function(t){this.entity.rotate(this.rotation)},Rotate.prototype.swap=function(t){};var IframePlane=pc.createScript("iframePlane");IframePlane.attributes.add("iframeUrl",{type:"string"}),IframePlane.attributes.add("iframePixelsPerUnit",{type:"number",default:640,description:"Number of canvas pixels per unit of world space. The larger the number, the higher the resolution of the iframe."}),IframePlane.prototype.initialize=function(){this.createScreen(this.iframeUrl)},IframePlane.prototype.createScreen=function(e){var t,r=document.getElementById("video-frame");r&&r.parentNode.removeChild(r),e?((t=document.createElement("iframe")).id="video-frame",t.src=e,t.style.border="0px"):t=null,this._css3Plane=new pc.Css3Plane(t,this.entity,this.iframePixelsPerUnit);var i=new pc.StandardMaterial;i.depthWrite=!0,i.redWrite=!1,i.greenWrite=!1,i.blueWrite=!1,i.alphaWrite=!1,i.blendType=pc.BLEND_NONE,i.opacity=0,i.update(),this.entity.model.material=i},IframePlane.prototype.swap=function(){var e;this.iframeUrl?((e=document.createElement("iframe")).src=this.iframeUrl,e.style.border="0px"):e=null,this._css3Plane=new pc.Css3Plane(e,this.entity,this.iframePixelsPerUnit);var t=new pc.StandardMaterial;t.depthWrite=!0,t.redWrite=!1,t.greenWrite=!1,t.blueWrite=!1,t.alphaWrite=!1,t.blendType=pc.BLEND_NONE,t.opacity=0,t.update(),this.entity.model.material=t},pc.extend(pc,function(){"use strict";var epsilon=function(e){return Math.abs(e)<1e-10?0:e},e=pc.Application.getApplication(),getCameraCSSMatrix=function(e){var t=e.data;return"matrix3d("+epsilon(t[0])+","+epsilon(-t[1])+","+epsilon(t[2])+","+epsilon(t[3])+","+epsilon(t[4])+","+epsilon(-t[5])+","+epsilon(t[6])+","+epsilon(t[7])+","+epsilon(t[8])+","+epsilon(-t[9])+","+epsilon(t[10])+","+epsilon(t[11])+","+epsilon(t[12])+","+epsilon(-t[13])+","+epsilon(t[14])+","+epsilon(t[15])+")"},Css3Renderer=function(){if(e.css3Renderer)return e.css3Renderer;e.css3Renderer=this,this._stageElement=null,this._cameras=[],this._cameraElements=[],this._defaultCameraElement=null,this._css3Targets=[],this._cameraInvertMat=new pc.Mat4,this._cameraHalfSize=new pc.Vec2;var t=document.createElement("div");t.style.overflow="hidden",t.style.pointerEvents="auto",document.body.appendChild(t);var r=e.touch;r&&r.attach(t);var i=document.getElementById("application-canvas");i.style.pointerEvents="none",document.body.insertBefore(t,i),this._stageElement=t,this._defaultCameraElement=this.addCamera(e.root.findComponent("camera"));var a=this;function onWindowResize(){a._width=window.innerWidth,a._height=window.innerHeight,a._widthHalf=a._width/2,a._heightHalf=a._height/2,a._stageElement.style.width=a._width+"px",a._stageElement.style.height=a._height+"px";for(var e=0;e<a._cameraElements.length;e++)a._cameraElements[e].style.width=a._width+"px",a._cameraElements[e].style.height=a._height+"px"}onWindowResize(),window.addEventListener("resize",onWindowResize,!1)};Css3Renderer.prototype={render:function(){this._isRendering||(this._isRendering=!0,e.on("update",this._renderElements,this))},cancelRender:function(){e.off("update",this._renderElements,this),this._isRendering=!1},addCamera:function(e){if(!e)return this._defaultCameraElement;if(this._cameras.indexOf(e)>-1)return this._cameraElements[this._cameras.indexOf(e)];var t=document.createElement("div");return t.style.WebkitTransformStyle="preserve-3d",t.style.transformStyle="preserve-3d",t.style.pointerEvents="none",this._stageElement.appendChild(t),this._cameras.push(e),this._cameraElements.push(t),t},addTarget:function(e){this._css3Targets.indexOf(e)<=-1&&this._css3Targets.push(e)},blockEvents:function(e){for(var t=0;t<this._css3Targets.length;this._css3Targets[t++].blockEvents(e));},_renderElements:function(){for(var e=0;e<this._cameras.length;e++){var t,r,i,a=this._cameras[e],n=this._cameraElements[e],s=a.projectionMatrix.data[5]*this._heightHalf;a.projection==pc.PROJECTION_PERSPECTIVE?(this._stageElement.style.WebkitPerspective=s+"px",this._stageElement.style.perspective=s+"px"):(this._stageElement.style.WebkitPerspective="",this._stageElement.style.perspective=""),a.projection==pc.PROJECTION_ORTHOGRAPHIC&&(pc.Mat4._getPerspectiveHalfSize(this._cameraHalfSize,a.fov,a.aspectRatio,a.nearClip,a.horizontalFov),t=-(this._cameraHalfSize.x-this._cameraHalfSize.x)/2,r=(this._cameraHalfSize.y-this._cameraHalfSize.y)/2),this._cameraInvertMat.copy(a.entity.getWorldTransform()).invert(),i=(a.projection==pc.PROJECTION_ORTHOGRAPHIC?"scale("+s+")translate("+epsilon(t)+"px,"+epsilon(r)+"px)"+getCameraCSSMatrix(this._cameraInvertMat):"translateZ("+s+"px)"+getCameraCSSMatrix(this._cameraInvertMat))+"translate("+this._widthHalf+"px,"+this._heightHalf+"px)",n.style.WebkitTransform=i,n.style.transform=i}for(var h=0;h<this._css3Targets.length;this._css3Targets[h++].updateTransform());}};var Css3Plane=function(t,r,i,a){e.css3Renderer||(e.css3Renderer=new pc.Css3Renderer),this._renderer=e.css3Renderer,t||((t=document.createElement("div")).innerHTML="CSS3 Plane",t.style.backgroundColor="rgb("+Math.round(255*Math.random())+","+Math.round(255*Math.random())+","+Math.round(255*Math.random())+")",t.style.textAlign="center"),t.style.position="absolute",t.style.pointerEvents="auto",this.dom=t,r||(r=new pc.Entity,e.root.addChild(r)),this.entity=r,this._renderer.addCamera(a).appendChild(t),this._maxWidth=1920,this._maxHeight=1080,i=i||this._maxWidth,this.pixelsPerWorldUnit=new pc.Vec2(i,i),this._renderer.addTarget(this),this._renderer.render()};return Css3Plane.prototype={updateTransform:function(){var e,t,r,i=this.entity.getWorldTransform(),a=i.getScale(),n=Math.min(a.x*this.pixelsPerWorldUnit.x,this._maxWidth),s=Math.min(a.z*this.pixelsPerWorldUnit.y,this._maxHeight),h=(e=n,t=s,r=i.data,"translate(-50%,-50%)matrix3d("+epsilon(r[0]/e)+","+epsilon(r[1]/e)+","+epsilon(r[2]/e)+","+epsilon(r[3]/e)+","+epsilon(r[8]/t)+","+epsilon(r[9]/t)+","+epsilon(r[10]/t)+","+epsilon(r[11]/t)+","+epsilon(r[4])+","+epsilon(r[5])+","+epsilon(r[6])+","+epsilon(r[7])+","+epsilon(r[12])+","+epsilon(r[13])+","+epsilon(r[14])+","+epsilon(r[15])+")");this.dom.style.width=Math.round(n)+"px",this.dom.style.height=Math.round(s)+"px",this.dom.style.lineHeight=this.dom.style.height,this.dom.style.WebkitTransform=h,this.dom.style.transform=h},blockEvents:function(e){this.dom.style.pointerEvents=e?"none":"auto"},attachPlane:function(e){this.entity=e}},{Css3Renderer:Css3Renderer,Css3Plane:Css3Plane}}());var OrbitCamera=pc.createScript("orbitCamera");OrbitCamera.attributes.add("distanceMax",{type:"number",default:0,title:"Distance Max",description:"Setting this at 0 will give an infinite distance limit"}),OrbitCamera.attributes.add("distanceMin",{type:"number",default:0,title:"Distance Min"}),OrbitCamera.attributes.add("pitchAngleMax",{type:"number",default:90,title:"Pitch Angle Max (degrees)"}),OrbitCamera.attributes.add("pitchAngleMin",{type:"number",default:-90,title:"Pitch Angle Min (degrees)"}),OrbitCamera.attributes.add("inertiaFactor",{type:"number",default:0,title:"Inertia Factor",description:"Higher value means that the camera will continue moving after the user has stopped dragging. 0 is fully responsive."}),OrbitCamera.attributes.add("focusEntity",{type:"entity",title:"Focus Entity",description:"Entity for the camera to focus on. If blank, then the camera will use the whole scene"}),OrbitCamera.attributes.add("frameOnStart",{type:"boolean",default:!0,title:"Frame on Start",description:'Frames the entity or scene at the start of the application."'}),Object.defineProperty(OrbitCamera.prototype,"distance",{get:function(){return this._targetDistance},set:function(t){this._targetDistance=this._clampDistance(t)}}),Object.defineProperty(OrbitCamera.prototype,"pitch",{get:function(){return this._targetPitch},set:function(t){this._targetPitch=this._clampPitchAngle(t)}}),Object.defineProperty(OrbitCamera.prototype,"yaw",{get:function(){return this._targetYaw},set:function(t){this._targetYaw=t;var i=(this._targetYaw-this._yaw)%360;this._targetYaw=i>180?this._yaw-(360-i):i<-180?this._yaw+(360+i):this._yaw+i}}),Object.defineProperty(OrbitCamera.prototype,"pivotPoint",{get:function(){return this._pivotPoint},set:function(t){this._pivotPoint.copy(t)}}),OrbitCamera.prototype.focus=function(t){this._buildAabb(t,0);var i=this._modelsAabb.halfExtents,e=Math.max(i.x,Math.max(i.y,i.z));e/=Math.tan(.5*this.entity.camera.fov*pc.math.DEG_TO_RAD),e*=2,this.distance=e,this._removeInertia(),this._pivotPoint.copy(this._modelsAabb.center)},OrbitCamera.distanceBetween=new pc.Vec3,OrbitCamera.prototype.resetAndLookAtPoint=function(t,i){this.pivotPoint.copy(i),this.entity.setPosition(t),this.entity.lookAt(i);var e=OrbitCamera.distanceBetween;e.sub2(i,t),this.distance=e.length(),this.pivotPoint.copy(i);var a=this.entity.getRotation();this.yaw=this._calcYaw(a),this.pitch=this._calcPitch(a,this.yaw),this._removeInertia(),this._updatePosition()},OrbitCamera.prototype.resetAndLookAtEntity=function(t,i){this._buildAabb(i,0),this.resetAndLookAtPoint(t,this._modelsAabb.center)},OrbitCamera.prototype.reset=function(t,i,e){this.pitch=i,this.yaw=t,this.distance=e,this._removeInertia()},OrbitCamera.prototype.initialize=function(){var t=this,onWindowResize=function(){t._checkAspectRatio()};window.addEventListener("resize",onWindowResize,!1),this._checkAspectRatio(),this._modelsAabb=new pc.BoundingBox,this._buildAabb(this.focusEntity||this.app.root,0),this.entity.lookAt(this._modelsAabb.center),this._pivotPoint=new pc.Vec3,this._pivotPoint.copy(this._modelsAabb.center);var i=this.entity.getRotation();if(this._yaw=this._calcYaw(i),this._pitch=this._clampPitchAngle(this._calcPitch(i,this._yaw)),this.entity.setLocalEulerAngles(this._pitch,this._yaw,0),this._distance=0,this._targetYaw=this._yaw,this._targetPitch=this._pitch,this.frameOnStart)this.focus(this.focusEntity||this.app.root);else{var e=new pc.Vec3;e.sub2(this.entity.getPosition(),this._pivotPoint),this._distance=this._clampDistance(e.length())}this._targetDistance=this._distance,this.on("attr:distanceMin",(function(t,i){this._targetDistance=this._clampDistance(this._distance)})),this.on("attr:distanceMax",(function(t,i){this._targetDistance=this._clampDistance(this._distance)})),this.on("attr:pitchAngleMin",(function(t,i){this._targetPitch=this._clampPitchAngle(this._pitch)})),this.on("attr:pitchAngleMax",(function(t,i){this._targetPitch=this._clampPitchAngle(this._pitch)})),this.on("attr:focusEntity",(function(t,i){this.frameOnStart?this.focus(t||this.app.root):this.resetAndLookAtEntity(this.entity.getPosition(),t||this.app.root)})),this.on("attr:frameOnStart",(function(t,i){t&&this.focus(this.focusEntity||this.app.root)})),this.on("destroy",(function(){window.removeEventListener("resize",onWindowResize,!1)})),this.pause=!1,this.app.on("disableOrbitCamera",(function(t){this.pause!=t&&(t?(this.pause=!0,this.distanceBac=this._distance,this.yawBac=this._yaw,this.pitchBac=this._pitch):(this._targetDistance=this._distance=this.distanceBac,this._targetYaw=this._yaw=this.yawBac,this._targetPitch=this._pitch=this.pitchBac,this.pause=!1))}),this)},OrbitCamera.prototype.update=function(t){if(!this.pause){var i=0===this.inertiaFactor?1:Math.min(t/this.inertiaFactor,1);this._distance=pc.math.lerp(this._distance,this._targetDistance,i),this._yaw=pc.math.lerp(this._yaw,this._targetYaw,i),this._pitch=pc.math.lerp(this._pitch,this._targetPitch,i),this._updatePosition()}},OrbitCamera.prototype._updatePosition=function(){this.entity.setLocalPosition(0,0,0),this.entity.setLocalEulerAngles(this._pitch,this._yaw,0);var t=this.entity.getPosition();t.copy(this.entity.forward),t.scale(-this._distance),t.add(this.pivotPoint),this.entity.setPosition(t)},OrbitCamera.prototype._removeInertia=function(){this._yaw=this._targetYaw,this._pitch=this._targetPitch,this._distance=this._targetDistance},OrbitCamera.prototype._checkAspectRatio=function(){var t=this.app.graphicsDevice.height,i=this.app.graphicsDevice.width;this.entity.camera.horizontalFov=t>i},OrbitCamera.prototype._buildAabb=function(t,i){var e=0;if(t.model){var a=t.model.meshInstances;for(e=0;e<a.length;e++)0===i?this._modelsAabb.copy(a[e].aabb):this._modelsAabb.add(a[e].aabb),i+=1}for(e=0;e<t.children.length;++e)i+=this._buildAabb(t.children[e],i);return i},OrbitCamera.prototype._calcYaw=function(t){var i=new pc.Vec3;return t.transformVector(pc.Vec3.FORWARD,i),Math.atan2(-i.x,-i.z)*pc.math.RAD_TO_DEG},OrbitCamera.prototype._clampDistance=function(t){return this.distanceMax>0?pc.math.clamp(t,this.distanceMin,this.distanceMax):Math.max(t,this.distanceMin)},OrbitCamera.prototype._clampPitchAngle=function(t){return pc.math.clamp(t,-this.pitchAngleMax,-this.pitchAngleMin)},OrbitCamera.quatWithoutYaw=new pc.Quat,OrbitCamera.yawOffset=new pc.Quat,OrbitCamera.prototype._calcPitch=function(t,i){var e=OrbitCamera.quatWithoutYaw,a=OrbitCamera.yawOffset;a.setFromEulerAngles(0,-i,0),e.mul2(a,t);var s=new pc.Vec3;return e.transformVector(pc.Vec3.FORWARD,s),Math.atan2(s.y,-s.z)*pc.math.RAD_TO_DEG};var KeyboardInput=pc.createScript("keyboardInput");KeyboardInput.prototype.initialize=function(){this.orbitCamera=this.entity.script.orbitCamera},KeyboardInput.prototype.postInitialize=function(){this.orbitCamera&&(this.startDistance=this.orbitCamera.distance,this.startYaw=this.orbitCamera.yaw,this.startPitch=this.orbitCamera.pitch,this.startPivotPosition=this.orbitCamera.pivotPoint.clone())},KeyboardInput.prototype.update=function(t){this.orbitCamera&&this.app.keyboard.wasPressed(pc.KEY_SPACE)&&(this.orbitCamera.reset(this.startYaw,this.startPitch,this.startDistance),this.orbitCamera.pivotPoint=this.startPivotPosition)};var HtmlHandler=pc.createScript("htmlHandler");HtmlHandler.attributes.add("html",{type:"asset",assetType:"html",title:"HTML Asset"}),HtmlHandler.prototype.initialize=function(){this.element=document.createElement("div"),this.element.classList.add("container"),document.body.appendChild(this.element),this.asset=null,this.assetId=0,this.counter=0},HtmlHandler.prototype.attachAsset=function(t,e){if(this.assetId=t,!this.assetId)return e.call(this);var s=this.app.assets.get(this.assetId),i=this;s._onLoad=function(t){e.call(i,t,t.resource)},s.on("load",s._onLoad),e.call(this,s,s.resource),this.app.assets.load(s)},HtmlHandler.prototype.template=function(t,e){this.asset&&this.asset!==t&&this.asset.off("load",this.asset._onLoad),this.asset=t,this.element.innerHTML=e||"",e&&this.bindEvents()},HtmlHandler.prototype.bindEvents=function(){var t=this,e=this.element.querySelector(".button"),s=this.element.querySelector(".inputBox");e&&e.addEventListener("click",(function(){var e=t.app.root.findByName("Screen Plane"),i=s.value.toString();e.script.iframePlane.createScreen("https://player.bilibili.com/player.html?&bvid="+i),console.log(i),console.log("button clicked")}),!1)},HtmlHandler.prototype.update=function(t){this.assetId!==this.html.id&&this.attachAsset(this.html.id,this.template)};var MouseInput=pc.createScript("mouseInput");MouseInput.attributes.add("orbitSensitivity",{type:"number",default:.3,title:"Orbit Sensitivity",description:"How fast the camera moves around the orbit. Higher is faster"}),MouseInput.attributes.add("distanceSensitivity",{type:"number",default:.15,title:"Distance Sensitivity",description:"How fast the camera moves in and out. Higher is faster"}),MouseInput.prototype.initialize=function(){if(this.orbitCamera=this.entity.script.orbitCamera,this.orbitCamera){var t=this,onMouseOut=function(o){t.onMouseOut(o)};this.app.mouse.on(pc.EVENT_MOUSEDOWN,this.onMouseDown,this),this.app.mouse.on(pc.EVENT_MOUSEUP,this.onMouseUp,this),this.app.mouse.on(pc.EVENT_MOUSEMOVE,this.onMouseMove,this),this.app.mouse.on(pc.EVENT_MOUSEWHEEL,this.onMouseWheel,this),window.addEventListener("mouseout",onMouseOut,!1),this.on("destroy",(function(){this.app.mouse.off(pc.EVENT_MOUSEDOWN,this.onMouseDown,this),this.app.mouse.off(pc.EVENT_MOUSEUP,this.onMouseUp,this),this.app.mouse.off(pc.EVENT_MOUSEMOVE,this.onMouseMove,this),this.app.mouse.off(pc.EVENT_MOUSEWHEEL,this.onMouseWheel,this),window.removeEventListener("mouseout",onMouseOut,!1)}))}this.app.mouse.disableContextMenu(),this.lookButtonDown=!1,this.panButtonDown=!1,this.lastPoint=new pc.Vec2},MouseInput.fromWorldPoint=new pc.Vec3,MouseInput.toWorldPoint=new pc.Vec3,MouseInput.worldDiff=new pc.Vec3,MouseInput.prototype.pan=function(t){var o=MouseInput.fromWorldPoint,e=MouseInput.toWorldPoint,s=MouseInput.worldDiff,i=this.entity.camera,n=this.orbitCamera.distance;i.screenToWorld(t.x,t.y,n,o),i.screenToWorld(this.lastPoint.x,this.lastPoint.y,n,e),s.sub2(e,o),this.orbitCamera.pivotPoint.add(s)},MouseInput.prototype.onMouseDown=function(t){switch(t.button){case pc.MOUSEBUTTON_LEFT:this.lookButtonDown=!0,pc.app.css3Renderer.blockEvents(!0);break;case pc.MOUSEBUTTON_MIDDLE:case pc.MOUSEBUTTON_RIGHT:this.panButtonDown=!0,pc.app.css3Renderer.blockEvents(!0)}},MouseInput.prototype.onMouseUp=function(t){switch(t.button){case pc.MOUSEBUTTON_LEFT:this.lookButtonDown=!1,pc.app.css3Renderer.blockEvents(!1);break;case pc.MOUSEBUTTON_MIDDLE:case pc.MOUSEBUTTON_RIGHT:this.panButtonDown=!1,pc.app.css3Renderer.blockEvents(!1)}},MouseInput.prototype.onMouseMove=function(t){pc.app.mouse;this.lookButtonDown?(this.orbitCamera.pitch-=t.dy*this.orbitSensitivity,this.orbitCamera.yaw-=t.dx*this.orbitSensitivity):this.panButtonDown&&this.pan(t),this.lastPoint.set(t.x,t.y)},MouseInput.prototype.onMouseWheel=function(t){this.orbitCamera.distance-=t.wheel*this.distanceSensitivity*(.1*this.orbitCamera.distance),t.event.preventDefault()},MouseInput.prototype.onMouseOut=function(t){this.lookButtonDown=!1,this.panButtonDown=!1,pc.app.css3Renderer.blockEvents(!1)};var CssHandler=pc.createScript("cssHandler");CssHandler.attributes.add("css",{type:"asset",assetType:"css",title:"CSS Asset"}),CssHandler.prototype.initialize=function(){this.element=document.createElement("style"),document.head.appendChild(this.element),this.asset=null,this.assetId=0},CssHandler.prototype.attachAsset=function(s,t){if(this.assetId=s,!this.assetId)return t.call(this);var e=this.app.assets.get(this.assetId),a=this;e._onLoad=function(s){t.call(a,s,s.resource)},e.on("load",e._onLoad),t.call(this,e,e.resource),this.app.assets.load(e)},CssHandler.prototype.template=function(s,t){this.asset&&this.asset!==s&&this.asset.off("load",this.asset._onLoad),this.asset=s,this.element.innerHTML=t||""},CssHandler.prototype.update=function(s){this.assetId!==this.css.id&&this.attachAsset(this.css.id,this.template)};var TouchInput=pc.createScript("touchInput");TouchInput.attributes.add("orbitSensitivity",{type:"number",default:.4,title:"Orbit Sensitivity",description:"How fast the camera moves around the orbit. Higher is faster"}),TouchInput.attributes.add("distanceSensitivity",{type:"number",default:.2,title:"Distance Sensitivity",description:"How fast the camera moves in and out. Higher is faster"}),TouchInput.prototype.initialize=function(){this.orbitCamera=this.entity.script.orbitCamera,this.lastTouchPoint=new pc.Vec2,this.lastPinchMidPoint=new pc.Vec2,this.lastPinchDistance=0,this.orbitCamera&&this.app.touch&&(this.app.touch.on(pc.EVENT_TOUCHSTART,this.onTouchStartEndCancel,this),this.app.touch.on(pc.EVENT_TOUCHEND,this.onTouchStartEndCancel,this),this.app.touch.on(pc.EVENT_TOUCHCANCEL,this.onTouchStartEndCancel,this),this.app.touch.on(pc.EVENT_TOUCHMOVE,this.onTouchMove,this),this.on("destroy",(function(){this.app.touch.off(pc.EVENT_TOUCHSTART,this.onTouchStartEndCancel,this),this.app.touch.off(pc.EVENT_TOUCHEND,this.onTouchStartEndCancel,this),this.app.touch.off(pc.EVENT_TOUCHCANCEL,this.onTouchStartEndCancel,this),this.app.touch.off(pc.EVENT_TOUCHMOVE,this.onTouchMove,this)})))},TouchInput.prototype.getPinchDistance=function(t,i){var o=t.x-i.x,n=t.y-i.y;return Math.sqrt(o*o+n*n)},TouchInput.prototype.calcMidPoint=function(t,i,o){o.set(i.x-t.x,i.y-t.y),o.scale(.5),o.x+=t.x,o.y+=t.y},TouchInput.prototype.onTouchStartEndCancel=function(t){var i=t.touches;1==i.length?(this.lastTouchPoint.set(i[0].x,i[0].y),pc.app.css3Renderer.blockEvents(!0)):2==i.length?(this.lastPinchDistance=this.getPinchDistance(i[0],i[1]),this.calcMidPoint(i[0],i[1],this.lastPinchMidPoint),pc.app.css3Renderer.blockEvents(!0)):pc.app.css3Renderer.blockEvents(!1)},TouchInput.fromWorldPoint=new pc.Vec3,TouchInput.toWorldPoint=new pc.Vec3,TouchInput.worldDiff=new pc.Vec3,TouchInput.prototype.pan=function(t){var i=TouchInput.fromWorldPoint,o=TouchInput.toWorldPoint,n=TouchInput.worldDiff,c=this.entity.camera,h=this.orbitCamera.distance;c.screenToWorld(t.x,t.y,h,i),c.screenToWorld(this.lastPinchMidPoint.x,this.lastPinchMidPoint.y,h,o),n.sub2(o,i),this.orbitCamera.pivotPoint.add(n)},TouchInput.pinchMidPoint=new pc.Vec2,TouchInput.prototype.onTouchMove=function(t){var i=TouchInput.pinchMidPoint,o=t.touches;if(1==o.length){var n=o[0];this.orbitCamera.pitch-=(n.y-this.lastTouchPoint.y)*this.orbitSensitivity,this.orbitCamera.yaw-=(n.x-this.lastTouchPoint.x)*this.orbitSensitivity,this.lastTouchPoint.set(n.x,n.y)}else if(2==o.length){var c=this.getPinchDistance(o[0],o[1]),h=c-this.lastPinchDistance;this.lastPinchDistance=c,this.orbitCamera.distance-=h*this.distanceSensitivity*.1*(.1*this.orbitCamera.distance),this.calcMidPoint(o[0],o[1],i),this.lastPinchMidPoint.copy(i)}};var KeyboardInput=pc.createScript("keyboardInput");KeyboardInput.prototype.initialize=function(){this.orbitCamera=this.entity.script.orbitCamera},KeyboardInput.prototype.postInitialize=function(){this.orbitCamera&&(this.startDistance=this.orbitCamera.distance,this.startYaw=this.orbitCamera.yaw,this.startPitch=this.orbitCamera.pitch,this.startPivotPosition=this.orbitCamera.pivotPoint.clone())},KeyboardInput.prototype.update=function(t){this.orbitCamera&&this.app.keyboard.wasPressed(pc.KEY_SPACE)&&(this.orbitCamera.reset(this.startYaw,this.startPitch,this.startDistance),this.orbitCamera.pivotPoint=this.startPivotPosition)};var OrbitCamera=pc.createScript("orbitCamera");OrbitCamera.attributes.add("distanceMax",{type:"number",default:0,title:"Distance Max",description:"Setting this at 0 will give an infinite distance limit"}),OrbitCamera.attributes.add("distanceMin",{type:"number",default:0,title:"Distance Min"}),OrbitCamera.attributes.add("pitchAngleMax",{type:"number",default:90,title:"Pitch Angle Max (degrees)"}),OrbitCamera.attributes.add("pitchAngleMin",{type:"number",default:-90,title:"Pitch Angle Min (degrees)"}),OrbitCamera.attributes.add("inertiaFactor",{type:"number",default:0,title:"Inertia Factor",description:"Higher value means that the camera will continue moving after the user has stopped dragging. 0 is fully responsive."}),OrbitCamera.attributes.add("focusEntity",{type:"entity",title:"Focus Entity",description:"Entity for the camera to focus on. If blank, then the camera will use the whole scene"}),OrbitCamera.attributes.add("frameOnStart",{type:"boolean",default:!0,title:"Frame on Start",description:'Frames the entity or scene at the start of the application."'}),Object.defineProperty(OrbitCamera.prototype,"distance",{get:function(){return this._targetDistance},set:function(t){this._targetDistance=this._clampDistance(t)}}),Object.defineProperty(OrbitCamera.prototype,"pitch",{get:function(){return this._targetPitch},set:function(t){this._targetPitch=this._clampPitchAngle(t)}}),Object.defineProperty(OrbitCamera.prototype,"yaw",{get:function(){return this._targetYaw},set:function(t){this._targetYaw=t;var i=(this._targetYaw-this._yaw)%360;this._targetYaw=i>180?this._yaw-(360-i):i<-180?this._yaw+(360+i):this._yaw+i}}),Object.defineProperty(OrbitCamera.prototype,"pivotPoint",{get:function(){return this._pivotPoint},set:function(t){this._pivotPoint.copy(t)}}),OrbitCamera.prototype.focus=function(t){this._buildAabb(t,0);var i=this._modelsAabb.halfExtents,e=Math.max(i.x,Math.max(i.y,i.z));e/=Math.tan(.5*this.entity.camera.fov*pc.math.DEG_TO_RAD),e*=2,this.distance=e,this._removeInertia(),this._pivotPoint.copy(this._modelsAabb.center)},OrbitCamera.distanceBetween=new pc.Vec3,OrbitCamera.prototype.resetAndLookAtPoint=function(t,i){this.pivotPoint.copy(i),this.entity.setPosition(t),this.entity.lookAt(i);var e=OrbitCamera.distanceBetween;e.sub2(i,t),this.distance=e.length(),this.pivotPoint.copy(i);var a=this.entity.getRotation();this.yaw=this._calcYaw(a),this.pitch=this._calcPitch(a,this.yaw),this._removeInertia(),this._updatePosition()},OrbitCamera.prototype.resetAndLookAtEntity=function(t,i){this._buildAabb(i,0),this.resetAndLookAtPoint(t,this._modelsAabb.center)},OrbitCamera.prototype.reset=function(t,i,e){this.pitch=i,this.yaw=t,this.distance=e,this._removeInertia()},OrbitCamera.prototype.initialize=function(){var t=this,onWindowResize=function(){t._checkAspectRatio()};window.addEventListener("resize",onWindowResize,!1),this._checkAspectRatio(),this._modelsAabb=new pc.BoundingBox,this._buildAabb(this.focusEntity||this.app.root,0),this.entity.lookAt(this._modelsAabb.center),this._pivotPoint=new pc.Vec3,this._pivotPoint.copy(this._modelsAabb.center);var i=this.entity.getRotation();if(this._yaw=this._calcYaw(i),this._pitch=this._clampPitchAngle(this._calcPitch(i,this._yaw)),this.entity.setLocalEulerAngles(this._pitch,this._yaw,0),this._distance=0,this._targetYaw=this._yaw,this._targetPitch=this._pitch,this.frameOnStart)this.focus(this.focusEntity||this.app.root);else{var e=new pc.Vec3;e.sub2(this.entity.getPosition(),this._pivotPoint),this._distance=this._clampDistance(e.length())}this._targetDistance=this._distance,this.on("attr:distanceMin",(function(t,i){this._targetDistance=this._clampDistance(this._distance)})),this.on("attr:distanceMax",(function(t,i){this._targetDistance=this._clampDistance(this._distance)})),this.on("attr:pitchAngleMin",(function(t,i){this._targetPitch=this._clampPitchAngle(this._pitch)})),this.on("attr:pitchAngleMax",(function(t,i){this._targetPitch=this._clampPitchAngle(this._pitch)})),this.on("attr:focusEntity",(function(t,i){this.frameOnStart?this.focus(t||this.app.root):this.resetAndLookAtEntity(this.entity.getPosition(),t||this.app.root)})),this.on("attr:frameOnStart",(function(t,i){t&&this.focus(this.focusEntity||this.app.root)})),this.on("destroy",(function(){window.removeEventListener("resize",onWindowResize,!1)})),this.pause=!1,this.app.on("disableOrbitCamera",(function(t){this.pause!=t&&(t?(this.pause=!0,this.distanceBac=this._distance,this.yawBac=this._yaw,this.pitchBac=this._pitch):(this._targetDistance=this._distance=this.distanceBac,this._targetYaw=this._yaw=this.yawBac,this._targetPitch=this._pitch=this.pitchBac,this.pause=!1))}),this)},OrbitCamera.prototype.update=function(t){if(!this.pause){var i=0===this.inertiaFactor?1:Math.min(t/this.inertiaFactor,1);this._distance=pc.math.lerp(this._distance,this._targetDistance,i),this._yaw=pc.math.lerp(this._yaw,this._targetYaw,i),this._pitch=pc.math.lerp(this._pitch,this._targetPitch,i),this._updatePosition()}},OrbitCamera.prototype._updatePosition=function(){this.entity.setLocalPosition(0,0,0),this.entity.setLocalEulerAngles(this._pitch,this._yaw,0);var t=this.entity.getPosition();t.copy(this.entity.forward),t.scale(-this._distance),t.add(this.pivotPoint),this.entity.setPosition(t)},OrbitCamera.prototype._removeInertia=function(){this._yaw=this._targetYaw,this._pitch=this._targetPitch,this._distance=this._targetDistance},OrbitCamera.prototype._checkAspectRatio=function(){var t=this.app.graphicsDevice.height,i=this.app.graphicsDevice.width;this.entity.camera.horizontalFov=t>i},OrbitCamera.prototype._buildAabb=function(t,i){var e=0;if(t.model){var a=t.model.meshInstances;for(e=0;e<a.length;e++)0===i?this._modelsAabb.copy(a[e].aabb):this._modelsAabb.add(a[e].aabb),i+=1}for(e=0;e<t.children.length;++e)i+=this._buildAabb(t.children[e],i);return i},OrbitCamera.prototype._calcYaw=function(t){var i=new pc.Vec3;return t.transformVector(pc.Vec3.FORWARD,i),Math.atan2(-i.x,-i.z)*pc.math.RAD_TO_DEG},OrbitCamera.prototype._clampDistance=function(t){return this.distanceMax>0?pc.math.clamp(t,this.distanceMin,this.distanceMax):Math.max(t,this.distanceMin)},OrbitCamera.prototype._clampPitchAngle=function(t){return pc.math.clamp(t,-this.pitchAngleMax,-this.pitchAngleMin)},OrbitCamera.quatWithoutYaw=new pc.Quat,OrbitCamera.yawOffset=new pc.Quat,OrbitCamera.prototype._calcPitch=function(t,i){var e=OrbitCamera.quatWithoutYaw,a=OrbitCamera.yawOffset;a.setFromEulerAngles(0,-i,0),e.mul2(a,t);var s=new pc.Vec3;return e.transformVector(pc.Vec3.FORWARD,s),Math.atan2(s.y,-s.z)*pc.math.RAD_TO_DEG};var MouseInput=pc.createScript("mouseInput");MouseInput.attributes.add("orbitSensitivity",{type:"number",default:.3,title:"Orbit Sensitivity",description:"How fast the camera moves around the orbit. Higher is faster"}),MouseInput.attributes.add("distanceSensitivity",{type:"number",default:.15,title:"Distance Sensitivity",description:"How fast the camera moves in and out. Higher is faster"}),MouseInput.prototype.initialize=function(){if(this.orbitCamera=this.entity.script.orbitCamera,this.orbitCamera){var t=this,onMouseOut=function(o){t.onMouseOut(o)};this.app.mouse.on(pc.EVENT_MOUSEDOWN,this.onMouseDown,this),this.app.mouse.on(pc.EVENT_MOUSEUP,this.onMouseUp,this),this.app.mouse.on(pc.EVENT_MOUSEMOVE,this.onMouseMove,this),this.app.mouse.on(pc.EVENT_MOUSEWHEEL,this.onMouseWheel,this),window.addEventListener("mouseout",onMouseOut,!1),this.on("destroy",(function(){this.app.mouse.off(pc.EVENT_MOUSEDOWN,this.onMouseDown,this),this.app.mouse.off(pc.EVENT_MOUSEUP,this.onMouseUp,this),this.app.mouse.off(pc.EVENT_MOUSEMOVE,this.onMouseMove,this),this.app.mouse.off(pc.EVENT_MOUSEWHEEL,this.onMouseWheel,this),window.removeEventListener("mouseout",onMouseOut,!1)}))}this.app.mouse.disableContextMenu(),this.lookButtonDown=!1,this.panButtonDown=!1,this.lastPoint=new pc.Vec2},MouseInput.fromWorldPoint=new pc.Vec3,MouseInput.toWorldPoint=new pc.Vec3,MouseInput.worldDiff=new pc.Vec3,MouseInput.prototype.pan=function(t){var o=MouseInput.fromWorldPoint,e=MouseInput.toWorldPoint,s=MouseInput.worldDiff,i=this.entity.camera,n=this.orbitCamera.distance;i.screenToWorld(t.x,t.y,n,o),i.screenToWorld(this.lastPoint.x,this.lastPoint.y,n,e),s.sub2(e,o),this.orbitCamera.pivotPoint.add(s)},MouseInput.prototype.onMouseDown=function(t){switch(t.button){case pc.MOUSEBUTTON_LEFT:this.lookButtonDown=!0,pc.app.css3Renderer.blockEvents(!0);break;case pc.MOUSEBUTTON_MIDDLE:case pc.MOUSEBUTTON_RIGHT:this.panButtonDown=!0,pc.app.css3Renderer.blockEvents(!0)}},MouseInput.prototype.onMouseUp=function(t){switch(t.button){case pc.MOUSEBUTTON_LEFT:this.lookButtonDown=!1,pc.app.css3Renderer.blockEvents(!1);break;case pc.MOUSEBUTTON_MIDDLE:case pc.MOUSEBUTTON_RIGHT:this.panButtonDown=!1,pc.app.css3Renderer.blockEvents(!1)}},MouseInput.prototype.onMouseMove=function(t){pc.app.mouse;this.lookButtonDown?(this.orbitCamera.pitch-=t.dy*this.orbitSensitivity,this.orbitCamera.yaw-=t.dx*this.orbitSensitivity):this.panButtonDown&&this.pan(t),this.lastPoint.set(t.x,t.y)},MouseInput.prototype.onMouseWheel=function(t){this.orbitCamera.distance-=t.wheel*this.distanceSensitivity*(.1*this.orbitCamera.distance),t.event.preventDefault()},MouseInput.prototype.onMouseOut=function(t){this.lookButtonDown=!1,this.panButtonDown=!1,pc.app.css3Renderer.blockEvents(!1)};var TouchInput=pc.createScript("touchInput");TouchInput.attributes.add("orbitSensitivity",{type:"number",default:.4,title:"Orbit Sensitivity",description:"How fast the camera moves around the orbit. Higher is faster"}),TouchInput.attributes.add("distanceSensitivity",{type:"number",default:.2,title:"Distance Sensitivity",description:"How fast the camera moves in and out. Higher is faster"}),TouchInput.prototype.initialize=function(){this.orbitCamera=this.entity.script.orbitCamera,this.lastTouchPoint=new pc.Vec2,this.lastPinchMidPoint=new pc.Vec2,this.lastPinchDistance=0,this.orbitCamera&&this.app.touch&&(this.app.touch.on(pc.EVENT_TOUCHSTART,this.onTouchStartEndCancel,this),this.app.touch.on(pc.EVENT_TOUCHEND,this.onTouchStartEndCancel,this),this.app.touch.on(pc.EVENT_TOUCHCANCEL,this.onTouchStartEndCancel,this),this.app.touch.on(pc.EVENT_TOUCHMOVE,this.onTouchMove,this),this.on("destroy",(function(){this.app.touch.off(pc.EVENT_TOUCHSTART,this.onTouchStartEndCancel,this),this.app.touch.off(pc.EVENT_TOUCHEND,this.onTouchStartEndCancel,this),this.app.touch.off(pc.EVENT_TOUCHCANCEL,this.onTouchStartEndCancel,this),this.app.touch.off(pc.EVENT_TOUCHMOVE,this.onTouchMove,this)})))},TouchInput.prototype.getPinchDistance=function(t,i){var o=t.x-i.x,n=t.y-i.y;return Math.sqrt(o*o+n*n)},TouchInput.prototype.calcMidPoint=function(t,i,o){o.set(i.x-t.x,i.y-t.y),o.scale(.5),o.x+=t.x,o.y+=t.y},TouchInput.prototype.onTouchStartEndCancel=function(t){var i=t.touches;1==i.length?(this.lastTouchPoint.set(i[0].x,i[0].y),pc.app.css3Renderer.blockEvents(!0)):2==i.length?(this.lastPinchDistance=this.getPinchDistance(i[0],i[1]),this.calcMidPoint(i[0],i[1],this.lastPinchMidPoint),pc.app.css3Renderer.blockEvents(!0)):pc.app.css3Renderer.blockEvents(!1)},TouchInput.fromWorldPoint=new pc.Vec3,TouchInput.toWorldPoint=new pc.Vec3,TouchInput.worldDiff=new pc.Vec3,TouchInput.prototype.pan=function(t){var i=TouchInput.fromWorldPoint,o=TouchInput.toWorldPoint,n=TouchInput.worldDiff,c=this.entity.camera,h=this.orbitCamera.distance;c.screenToWorld(t.x,t.y,h,i),c.screenToWorld(this.lastPinchMidPoint.x,this.lastPinchMidPoint.y,h,o),n.sub2(o,i),this.orbitCamera.pivotPoint.add(n)},TouchInput.pinchMidPoint=new pc.Vec2,TouchInput.prototype.onTouchMove=function(t){var i=TouchInput.pinchMidPoint,o=t.touches;if(1==o.length){var n=o[0];this.orbitCamera.pitch-=(n.y-this.lastTouchPoint.y)*this.orbitSensitivity,this.orbitCamera.yaw-=(n.x-this.lastTouchPoint.x)*this.orbitSensitivity,this.lastTouchPoint.set(n.x,n.y)}else if(2==o.length){var c=this.getPinchDistance(o[0],o[1]),h=c-this.lastPinchDistance;this.lastPinchDistance=c,this.orbitCamera.distance-=h*this.distanceSensitivity*.1*(.1*this.orbitCamera.distance),this.calcMidPoint(o[0],o[1],i),this.lastPinchMidPoint.copy(i)}};var UiSpeed=pc.createScript("uiSpeed");UiSpeed.attributes.add("car",{type:"entity"}),UiSpeed.prototype.initialize=function(){var t=setInterval(function(){if(this.car&&this.car.script){var t=this.car.script.vehicle.speed,e=Math.abs(t),i="Speed: "+Math.round(e)+"km/h";t<0&&(i+=" (R)"),this.entity.element.text=i}}.bind(this),100);this.on("destroy",(function(){clearInterval(t)}),this)};var FollowCamera=pc.createScript("followCamera");FollowCamera.attributes.add("target",{type:"entity",title:"Target",description:"The target entity to follow"}),FollowCamera.attributes.add("cameraOffset",{type:"vec3",default:[0,5,-10],title:"Camera Offset",description:"The local space offset with respect to the target entity coordinate system"}),FollowCamera.attributes.add("lerpAmount",{type:"number",min:0,max:1,default:.1,title:"Lerp Amount",description:"The amount to lerp the camera towards its desired position every frame based on a 60fps frame rate. Lerping is frame rate independent though and will be correct for other frame rates."}),FollowCamera.prototype.initialize=function(){this.targetPos=new pc.Vec3,this.matrix=new pc.Mat4,this.quat=new pc.Quat,this.vec=new pc.Vec3,this.target?(this.updateTargetPosition(),this.currentPos=this.targetPos.clone()):this.currentPos=this.entity.getPosition().clone()},FollowCamera.prototype.updateTargetPosition=function(){var t=this.target.forward;this.vec.set(-t.x,0,-t.z).normalize();var e=180*Math.atan2(this.vec.x,this.vec.z)/Math.PI;this.quat.setFromEulerAngles(0,e,0),this.matrix.setTRS(this.target.getPosition(),this.quat,pc.Vec3.ONE),this.matrix.transformPoint(this.cameraOffset,this.targetPos)},FollowCamera.prototype.postUpdate=function(t){this.target&&(this.updateTargetPosition(),this.currentPos.lerp(this.currentPos,this.targetPos,1-Math.pow(1-this.lerpAmount,t)),this.entity.setPosition(this.currentPos),this.entity.lookAt(this.target.getPosition()))};var Vehicle=pc.createScript("vehicle");Vehicle.attributes.add("wheels",{type:"entity",array:!0,title:"Wheels"}),Vehicle.attributes.add("maxEngineForce",{type:"number",default:2e3,title:"Max Engine Force"}),Vehicle.attributes.add("maxBrakingForce",{type:"number",default:100,title:"Max Braking Force"}),Vehicle.attributes.add("maxSteering",{type:"number",default:.3,title:"Max Steering"}),Object.defineProperty(Vehicle.prototype,"speed",{get:function(){return this.vehicle?this.vehicle.getCurrentSpeedKmHour():0}}),Vehicle.prototype.postInitialize=function(){var e=this.entity.rigidbody.body,t=this.app.systems.rigidbody.dynamicsWorld,i=new Ammo.btVehicleTuning,s=new Ammo.btDefaultVehicleRaycaster(t),n=new Ammo.btRaycastVehicle(i,e,s);n.setCoordinateSystem(0,1,2);e.setActivationState(4);var r=new Ammo.btVector3(-1,0,0),o=new Ammo.btVector3(0,-1,0),h=new Ammo.btVector3(0,0,0);this.wheels.forEach((function(e){var t=e.script.vehicleWheel,s=t.frictionSlip,a=t.isFront,l=t.radius,d=t.rollInfluence,u=t.suspensionCompression,c=t.suspensionDamping,p=t.suspensionRestLength,b=t.suspensionStiffness,f=e.getLocalPosition();h.setValue(f.x,f.y,f.z);var g=n.addWheel(h,o,r,p,l,i,a);g.set_m_suspensionStiffness(b),g.set_m_wheelsDampingRelaxation(c),g.set_m_wheelsDampingCompression(u),g.set_m_frictionSlip(s),g.set_m_rollInfluence(d)}),this),Ammo.destroy(r),Ammo.destroy(o),Ammo.destroy(h),t.addAction(n),this.vehicle=n,this.engineForce=0,this.brakingForce=0,this.steering=0,this.on("enable",(function(){t.addAction(n)})),this.on("disable",(function(){t.removeAction(n)})),this.on("destroy",(function(){t.removeAction(n),Ammo.destroy(s),Ammo.destroy(n)})),this.on("vehicle:controls",(function(e,t){this.steering=pc.math.lerp(this.steering,e*this.maxSteering,.3),t>0?(this.brakingForce=0,this.engineForce=this.maxEngineForce):t<0?(this.brakingForce=0,this.engineForce=-this.maxEngineForce):(this.brakingForce=this.maxBrakingForce,this.engineForce=0)}))},Vehicle.prototype.update=function(e){var t,i=this.vehicle;i.setSteeringValue(this.steering,0),i.setSteeringValue(this.steering,1),i.applyEngineForce(this.engineForce,2),i.setBrake(this.brakingForce,2),i.applyEngineForce(this.engineForce,3),i.setBrake(this.brakingForce,3);var s=i.getNumWheels();for(t=0;t<s;t++){i.updateWheelTransform(t,!0);var n=this.vehicle.getWheelTransformWS(t),r=n.getOrigin(),o=n.getRotation(),h=this.wheels[t];h.setPosition(r.x(),r.y(),r.z()),h.setRotation(o.x(),o.y(),o.z(),o.w())}};var VehicleWheel=pc.createScript("vehicleWheel");VehicleWheel.attributes.add("isFront",{type:"boolean",default:!0,title:"Front Wheel"}),VehicleWheel.attributes.add("radius",{type:"number",default:.4,title:"Radius"}),VehicleWheel.attributes.add("width",{type:"number",default:.4,title:"Width"}),VehicleWheel.attributes.add("suspensionStiffness",{type:"number",default:10,title:"Suspension Stiffness"}),VehicleWheel.attributes.add("suspensionDamping",{type:"number",default:2.3,title:"Suspension Damping"}),VehicleWheel.attributes.add("suspensionCompression",{type:"number",default:4.4,title:"Suspension Compression"}),VehicleWheel.attributes.add("suspensionRestLength",{type:"number",default:.2,title:"Suspension Rest Length"}),VehicleWheel.attributes.add("rollInfluence",{type:"number",default:.2,title:"Roll Influence"}),VehicleWheel.attributes.add("frictionSlip",{type:"number",default:1e3,title:"Friction Slip"}),VehicleWheel.attributes.add("debugRender",{type:"boolean",default:!1,title:"Debug Render"}),VehicleWheel.prototype.initialize=function(){var createDebugWheel=function(e,t){var i=new pc.Entity;return i.addComponent("model",{type:"cylinder",castShadows:!0}),i.setLocalEulerAngles(0,0,90),i.setLocalScale(2*e,t,2*e),i};this.debugRender&&(this.debugWheel=createDebugWheel(this.radius,this.width),this.entity.addChild(this.debugWheel)),this.on("attr:debugRender",(function(e,t){e?(this.debugWheel=createDebugWheel(this.radius,this.width),this.entity.addChild(this.debugWheel)):this.debugWheel&&(this.debugWheel.destroy(),this.debugWheel=null)}))};var VehicleControls=pc.createScript("vehicleControls");VehicleControls.attributes.add("targetVehicle",{type:"entity",title:"Target Vehicle"}),VehicleControls.attributes.add("leftButton",{type:"entity",title:"Left Button"}),VehicleControls.attributes.add("rightButton",{type:"entity",title:"Right Button"}),VehicleControls.attributes.add("forwardButton",{type:"entity",title:"Forward Button"}),VehicleControls.attributes.add("reverseButton",{type:"entity",title:"Reverse Button"}),VehicleControls.prototype.initialize=function(){this.leftButtonPressed=!1,this.rightButtonPressed=!1,this.upButtonPressed=!1,this.downButtonPressed=!1,this.leftKeyPressed=!1,this.rightKeyPressed=!1,this.upKeyPressed=!1,this.downKeyPressed=!1,this.leftButton&&(this.leftButton.enabled=pc.platform.mobile,this.leftButton.button.on("pressedstart",(function(){this.leftButtonPressed=!0}),this),this.leftButton.button.on("pressedend",(function(){this.leftButtonPressed=!1}),this)),this.rightButton&&(this.rightButton.enabled=pc.platform.mobile,this.rightButton.button.on("pressedstart",(function(){this.rightButtonPressed=!0}),this),this.rightButton.button.on("pressedend",(function(){this.rightButtonPressed=!1}),this)),this.forwardButton&&(this.forwardButton.enabled=pc.platform.mobile,this.forwardButton.button.on("pressedstart",(function(){this.upButtonPressed=!0}),this),this.forwardButton.button.on("pressedend",(function(){this.upButtonPressed=!1}),this)),this.reverseButton&&(this.reverseButton.enabled=pc.platform.mobile,this.reverseButton.button.on("pressedstart",(function(){this.downButtonPressed=!0}),this),this.reverseButton.button.on("pressedend",(function(){this.downButtonPressed=!1}),this)),this.app.keyboard.on("keydown",(function(e){switch(e.key){case pc.KEY_A:case pc.KEY_LEFT:this.leftKeyPressed=!0;break;case pc.KEY_D:case pc.KEY_RIGHT:this.rightKeyPressed=!0;break;case pc.KEY_W:case pc.KEY_UP:this.upKeyPressed=!0;break;case pc.KEY_S:case pc.KEY_DOWN:this.downKeyPressed=!0}}),this),this.app.keyboard.on("keyup",(function(e){switch(e.key){case pc.KEY_A:case pc.KEY_LEFT:this.leftKeyPressed=!1;break;case pc.KEY_D:case pc.KEY_RIGHT:this.rightKeyPressed=!1;break;case pc.KEY_W:case pc.KEY_UP:this.upKeyPressed=!1;break;case pc.KEY_S:case pc.KEY_DOWN:this.downKeyPressed=!1}}),this)},VehicleControls.prototype.update=function(e){var t=this.targetVehicle?this.targetVehicle:this.entity;if(t){var i=0,s=0;(this.leftButtonPressed||this.leftKeyPressed)&&i++,(this.rightButtonPressed||this.rightKeyPressed)&&i--,(this.upButtonPressed||this.upKeyPressed)&&s++,(this.downButtonPressed||this.downKeyPressed)&&s--;this.app.xr.input.inputSources.forEach((function(e){e.handedness===pc.XRHAND_LEFT&&(i=-e.gamepad.axes[2],s-=e.gamepad.buttons[0].value),e.handedness===pc.XRHAND_RIGHT&&(s+=e.gamepad.buttons[0].value)})),t.script.vehicle.fire("vehicle:controls",i,s)}};var Exhaust=pc.createScript("exhaust");Exhaust.prototype.update=function(t){var e=this.app.root.findByName("Car Physics");e&&e.script&&e.script.vehicle&&(e.script.vehicle.engineForce>0?this.entity.particlesystem.play():this.entity.particlesystem.stop())};var ActionVr=pc.createScript("actionVr");ActionVr.attributes.add("startEvent",{type:"string",title:"Start Event",description:"Event that starts the VR session."}),ActionVr.attributes.add("endEvent",{type:"string",title:"End Event",description:"Event that ends the VR session."}),ActionVr.attributes.add("space",{type:"number",enum:[{"Bounded Floor":0},{Local:1},{"Local Floor":2},{Unbounded:3},{Viewer:4}],default:1,title:"Space",description:"The tracking space for the VR session."}),ActionVr.prototype.startVr=function(){var t=[pc.XRSPACE_BOUNDEDFLOOR,pc.XRSPACE_LOCAL,pc.XRSPACE_LOCALFLOOR,pc.XRSPACE_UNBOUNDED,pc.XRSPACE_VIEWER];this.app.xr.supported&&(this.app.xr.active||this.app.xr.isAvailable(pc.XRTYPE_VR)&&(window.DeviceOrientationEvent&&window.DeviceOrientationEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(function(e){"granted"==e&&window.addEventListener("deviceorientation",function(e){this.entity.camera.startXr(pc.XRTYPE_VR,t[this.space])}.bind(this))}.bind(this)).catch(console.error):this.entity.camera.startXr(pc.XRTYPE_VR,t[this.space])))},ActionVr.prototype.endVr=function(){this.app.xr.end()},ActionVr.prototype.initialize=function(){this.startEvent&&this.startEvent.length>0&&this.app.on(this.startEvent,this.startVr,this),this.endEvent&&this.endEvent.length>0&&this.app.on(this.endEvent,this.endVr,this),this.on("attr:startEvent",(function(t,e){e&&e.length>0&&app.off(e,this.startVr,this),t&&t.length>0&&app.on(t,this.startVr,this)})),this.on("attr:endEvent",(function(t,e){e&&e.length>0&&app.off(e,this.endVr,this),t&&t.length>0&&app.on(t,this.endVr,this)})),this.on("destroy",(function(){this.startEvent&&this.startEvent.length>0&&this.app.off(this.startEvent,this.startVr,this),this.endEvent&&this.endEvent.length>0&&this.app.off(this.endEvent,this.endVr,this)}))};var ActionPhysicsReset=pc.createScript("actionPhysicsReset");ActionPhysicsReset.attributes.add("event",{type:"string",title:"Event",description:"If the specified event is fired and this entity has a dynamic rigid body, it will be reset to its initial position and orientation. The event must be fired on the app."}),ActionPhysicsReset.prototype.postInitialize=function(){var t=this.app,e=this.entity,i=e.getPosition().clone(),n=e.getRotation().clone(),reset=function(){var t=e.rigidbody;t&&"dynamic"===t.type&&(t.teleport(i,n),t.linearVelocity=pc.Vec3.ZERO,t.angularVelocity=pc.Vec3.ZERO)};this.event&&this.event.length>0&&t.on(this.event,reset),this.on("attr:event",(function(e,i){i&&i.length>0&&t.off(i,reset),e&&e.length>0&&t.on(e,reset)})),this.on("destroy",(function(){this.event&&this.event.length>0&&t.off(this.event,reset)}))};var EventsButton=pc.createScript("eventsButton");EventsButton.attributes.add("clickEvent",{type:"string"}),EventsButton.attributes.add("pressedStartEvent",{type:"string"}),EventsButton.attributes.add("pressedEndEvent",{type:"string"}),EventsButton.attributes.add("hoverStartEvent",{type:"string"}),EventsButton.attributes.add("hoverEndEvent",{type:"string"}),EventsButton.prototype.initialize=function(){this.entity.button.on("click",(function(){this.clickEvent&&this.clickEvent.length>0&&this.app.fire(this.clickEvent)}),this),this.entity.button.on("pressedstart",(function(){this.pressedStartEvent&&this.pressedStartEvent.length>0&&this.app.fire(this.pressedStartEvent)}),this),this.entity.button.on("pressedend",(function(){this.pressedEndEvent&&this.pressedEndEvent.length>0&&this.app.fire(this.pressedEndEvent)}),this),this.entity.button.on("hoverstart",(function(){this.hoverStartEvent&&this.hoverStartEvent.length>0&&this.app.fire(this.hoverStartEvent)}),this),this.entity.button.on("hoverend",(function(){this.hoverEndEvent&&this.hoverEndEvent.length>0&&this.app.fire(this.hoverEndEvent)}),this)};var ActionSetBoolean=pc.createScript("actionSetBoolean");ActionSetBoolean.attributes.add("actions",{type:"json",schema:[{name:"event",title:"Event",description:"The event name that triggers this set action.",type:"string"},{name:"entity",title:"Entity",description:"The entity from where the path starts. If unset, this entity is used.",type:"entity"},{name:"path",title:"Path",description:"The path to set when the event fires.",type:"string"},{name:"value",title:"Value",type:"number",enum:[{False:0},{True:1}],description:"The value to set the property to.",default:1}],array:!0}),ActionSetBoolean.prototype.initialize=function(){this.actions.forEach((function(t){this.app.on(t.event,(function(){for(var e=t.path.split("."),n=t.entity?t.entity:this.entity,i=0;i<e.length-1;i++)n=n[e[i]];n[e[e.length-1]]=!!t.value}),this)}),this)};var VehicleGraphics=pc.createScript("vehicleGraphics");VehicleGraphics.attributes.add("physicsVehicle",{type:"entity"}),VehicleGraphics.attributes.add("wheelNames",{type:"string",array:!0}),VehicleGraphics.attributes.add("wheelOffsets",{type:"vec3",array:!0}),VehicleGraphics.prototype.initialize=function(){this.wheels=[];for(var e=0;e<this.wheelNames.length;e++)this.wheels[e]=this.entity.findByName(this.wheelNames[e])},VehicleGraphics.prototype.postUpdate=function(e){if(this.physicsVehicle){this.entity.setPosition(this.physicsVehicle.getPosition()),this.entity.setRotation(this.physicsVehicle.getRotation());for(var t=0;t<this.wheels.length;t++){var i=this.wheels[t],s=this.physicsVehicle.script.vehicle.wheels[t];i&&s&&(i.setPosition(s.getPosition()),i.setRotation(s.getRotation()),i.rotateLocal(0,180,0))}}};pc.extend(pc,function(){var BrightnessContrastEffect=function(e){this.shader=new pc.Shader(e,{attributes:{aPosition:pc.SEMANTIC_POSITION},vshader:["attribute vec2 aPosition;","","varying vec2 vUv0;","","void main(void)","{","    gl_Position = vec4(aPosition, 0.0, 1.0);","    vUv0 = (aPosition.xy + 1.0) * 0.5;","}"].join("\n"),fshader:["precision "+e.precision+" float;","uniform sampler2D uColorBuffer;","uniform sampler2D uLut;","varying vec2 vUv0;","vec4 lookup(in vec4 textureColor, in sampler2D lookupTable) {","mediump float blueColor = textureColor.b * 63.0;","mediump vec2 quad1;","quad1.y = floor(floor(blueColor) / 8.0);","quad1.x = floor(blueColor) - (quad1.y * 8.0);","mediump vec2 quad2;","quad2.y = floor(ceil(blueColor) / 8.0);","quad2.x = ceil(blueColor) - (quad2.y * 8.0);","highp vec2 texPos1;","texPos1.x = (quad1.x * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * textureColor.r);","texPos1.y = (quad1.y * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * textureColor.g);","texPos1.y = 1.0-texPos1.y;","highp vec2 texPos2;","texPos2.x = (quad2.x * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * textureColor.r);","texPos2.y = (quad2.y * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * textureColor.g);","texPos2.y = 1.0-texPos2.y;","lowp vec4 newColor1 = texture2D(lookupTable, texPos1);","lowp vec4 newColor2 = texture2D(lookupTable, texPos2);","lowp vec4 newColor = mix(newColor1, newColor2, fract(blueColor));","return newColor;","}","void main() {","vec4 base = texture2D( uColorBuffer, vUv0 );","gl_FragColor = lookup(base, uLut);","}"].join("\n")})};return(BrightnessContrastEffect=pc.inherits(BrightnessContrastEffect,pc.PostEffect)).prototype=pc.extend(BrightnessContrastEffect.prototype,{render:function(e,t,o){var r=this.device,s=r.scope;s.resolve("uColorBuffer").setValue(e.colorBuffer),s.resolve("uLut").setValue(this.textureLut.resource),pc.drawFullscreenQuad(r,t,this.vertexBuffer,this.shader,o)}}),{BrightnessContrastEffect:BrightnessContrastEffect}}());var BrightnessContrast=pc.createScript("brightnessContrast");BrightnessContrast.attributes.add("textureLut",{type:"asset",assetType:"texture",title:"LUT Texture"}),BrightnessContrast.prototype.initialize=function(){this.effect=new pc.BrightnessContrastEffect(this.app.graphicsDevice),this.effect.textureLut=this.textureLut,this.on("attr:textureLut",(function(e){this.effect.textureLut=e}));var e=this.entity.camera.postEffects;e.addEffect(this.effect),this.on("state",(function(t){t?e.addEffect(this.effect):e.removeEffect(this.effect)})),this.on("destroy",(function(){e.removeEffect(this.effect)}))};var UnloadAssetsOnClick=pc.createScript("unloadAssetsOnClick");UnloadAssetsOnClick.attributes.add("assetTag",{type:"string"}),UnloadAssetsOnClick.prototype.initialize=function(){this.entity.button.once("click",(function(){for(var t=this.app.assets.findByTag(this.assetTag),s=0;s<t.length;s++)t[s].unload()}),this)};var LoadSceneWithAssets=pc.createScript("loadSceneWithAssets");LoadSceneWithAssets.attributes.add("sceneName",{type:"string"}),LoadSceneWithAssets.attributes.add("loadingProgressTextEntity",{type:"entity"}),LoadSceneWithAssets.prototype.initialize=function(){this.entity.button.once("click",(function(){for(var t=this.app.assets.findByTag(this.sceneName),e=0,s=t.length,i=function(){loadScene(this.sceneName,{hierarchy:!0,settings:!0})}.bind(this),n=function(t){e+=1,console.log(t.name),this.loadingProgressTextEntity.element.text=e.toString()+"/"+s.toString()+" loaded",e===s&&i()}.bind(this),a=0;a<t.length;a++)t[a].ready(n),this.app.assets.load(t[a]);0===t.length&&i()}),this)};var CustomShader=pc.createScript("customShader");CustomShader.attributes.add("vs",{type:"asset",assetType:"shader",title:"Vertex Shader"}),CustomShader.attributes.add("fs",{type:"asset",assetType:"shader",title:"Fragment Shader"}),CustomShader.attributes.add("diffuseMap",{type:"asset",assetType:"texture",title:"Diffuse Map"}),CustomShader.attributes.add("heightMap",{type:"asset",assetType:"texture",title:"Height Map"}),CustomShader.prototype.initialize=function(){this.time=0;var e=this.app.graphicsDevice,t=this.diffuseMap.resource,a=this.heightMap.resource,s=this.vs.resource,r="precision "+e.precision+" float;\n";r+=this.fs.resource;var i={attributes:{aPosition:pc.SEMANTIC_POSITION,aUv0:pc.SEMANTIC_TEXCOORD0},vshader:s,fshader:r};this.shader=new pc.Shader(e,i),this.material=new pc.Material,this.material.shader=this.shader,this.material.setParameter("uTime",0),this.material.setParameter("uDiffuseMap",t),this.material.setParameter("uHeightMap",a);for(var h=this.entity.findComponents("render"),p=0;p<h.length;++p)for(var d=h[p].meshInstances,u=0;u<d.length;u++)d[u].material=this.material},CustomShader.prototype.update=function(e){this.time+=e;var t=this.time%2;t>1&&(t=1-(t-1)),this.material.setParameter("uTime",t)};var Wireframe=pc.createScript("wireframe");Wireframe.prototype.initialize=function(){this.entity.render.renderStyle=pc.RENDERSTYLE_WIREFRAME},Wireframe.prototype.update=function(e){};

//# sourceMappingURL=__game-scripts.js.map